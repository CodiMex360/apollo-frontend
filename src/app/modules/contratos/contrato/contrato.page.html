<ion-content id="revisionRowH">
  <div class="main-content">
    <ion-row style="margin: 1.2rem;">
      <ion-col size="6">
        <h2 style="color: var(--ion-color-dark-tint);">ESTATUS: <span
          [ngStyle]="{'background-color': statusColor ? statusColor : 'white'}"
          style="border-radius: 3px;">{{(contractData) ? statusC.labelStatus(contractData.estatus) : 'NUEVO CONTRATO'}}</span>
        </h2>

        <ion-row>
          <ion-col size="12" class="ion-align-self-center ion-no-padding ion-no-margin">
            <div class="folio-copy" *ngIf="num_contrato">
              <ion-label style="font-size: 1.2rem; margin-right: 1rem;">
                Num. {{this.contractTypePrefix.type === 'contrato' ? 'Contrato' : 'Reserva'}}: {{num_contrato}}
              </ion-label>
            </div>
            <div *ngIf="!num_contrato" class="status-badge-container">
              <span>Estatus</span>
              <ion-badge slot="end" color="warning">Sin guardar</ion-badge>
            </div>
          </ion-col>
        </ion-row>
      </ion-col>

      <ion-col size="6" class="ion-text-end">
        <button mat-raised-button class="button-success" [disabled]="step < 6" (click)="viewPDF()">Crear Contrato
        </button>        &nbsp;
        <button mat-raised-button class="button-cancel" (click)="cancelContract()">Cancelar Contrato</button>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12">
        <mat-accordion *ngIf="!contractData || (contractData && contractData.estatus != 2 )">
          <div class="accordion-margin">
            <mat-expansion-panel [expanded]="step === 0" hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Datos del Cliente
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="person"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <ion-card [disabled]="step >= 4 && contractData.estatus !== 4">
                <ion-card-content>
                  <form [formGroup]="clienteDataForm" *ngIf="clienteDataForm">
                    <ion-row>
                      <ion-col size="12">
                        <div class="search-row-buttons">
                          <ion-button size="small" color="secondary" (click)="openModalSearch('clientes', 'cliente')">
                            <ion-icon name="search"></ion-icon>
                          </ion-button>
                        </div>
                      </ion-col>
                    </ion-row>
                    <ion-row>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>NOMBRE(S)</mat-label>
                          <input type="text" matInput formControlName="nombre" autocomplete="off" maxlength="80">
                          <mat-error *ngIf="cf.nombre.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col>
                    </ion-row>

                    <ion-row>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>TELÉFONO</mat-label>
                          <input type="tel" matInput formControlName="telefono" autocomplete="off">
                          <mat-error *ngIf="cf.telefono.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>E-Mail</mat-label>
                          <input type="email" matInput formControlName="email" autocomplete="off">
                          <mat-error *ngIf="cf.email.errors?.required">Campo requerido</mat-error>
                          <mat-error *ngIf="cf.email.errors?.email">Email invalido</mat-error>
                        </mat-form-field>
                      </ion-col>
                    </ion-row>

                    <ion-row>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>DIRECCIÓN</mat-label>
                          <textarea matInput formControlName="direccion" autocomplete="off" maxlength="150"></textarea>
                          <mat-error *ngIf="cf.direccion.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col>
                    </ion-row>

                    <ion-row>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>Número de Licencia</mat-label>
                          <input type="text" matInput formControlName="num_licencia" autocomplete="off" maxlength="70">
                          <mat-error *ngIf="cf.num_licencia.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>Mes Exp.</mat-label>
                          <mat-select formControlName="licencia_mes" autocomplete="off">
                            <mat-option *ngFor="let month of months"
                                        value="{{month.digit}}">{{month.month}}</mat-option>
                          </mat-select>
                          <mat-icon matSuffix>date_range</mat-icon>
                          <mat-error *ngIf="cf.licencia_mes.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col>
                      <ion-col>
                        <mat-form-field appearance="legacy">
                          <mat-label>Año expiración</mat-label>
                          <mat-select formControlName="licencia_ano" autocomplete="off">
                            <mat-option *ngFor="let year of validYears" value="{{year}}">{{year}}</mat-option>
                          </mat-select>
                          <mat-icon matSuffix>date_range</mat-icon>
                          <mat-error *ngIf="cf.licencia_ano.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col>
                    </ion-row>

                  </form>

                  <app-modelos-docs model="clientes" docType="licencia_conducir" [fullSize]="true" [justButton]="true"
                                    [model_id_value]="clienteDataForm && clienteDataForm.controls.cliente_id.value ? clienteDataForm.controls.cliente_id.value : null">
                    <legend name="legend">Doc. Cliente</legend>
                  </app-modelos-docs>

                </ion-card-content>
                <ion-card-title>
                  <div class="card-action-buttons">
                    <ion-button color="success" (click)="saveProcess('datos_cliente')">SIGUIENTE</ion-button>
                  </div>
                </ion-card-title>
              </ion-card>
            </mat-expansion-panel>
          </div>
        </mat-accordion> <!-- Datos Cliente -->
        <mat-accordion *ngIf="!contractData || (contractData && contractData.estatus != 2 )">
          <div class="accordion-margin" [formGroup]="generalDataForm" *ngIf="generalDataForm">
            <mat-expansion-panel [expanded]="step === 1" hideToggle [disabled]="step == 0">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Datos Generales
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="calendar"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>
              <form [formGroup]="generalDataForm">
                <ion-card [disabled]="step >= 4 && contractData.estatus !== 4">
                  <ion-card-content>

                    <ion-row>
                      <ion-col size="12" size-md="6">
                        <mat-form-field appearance="legacy">
                          <mat-label>Lugar de Salida</mat-label>
                          <mat-select formControlName="ub_salida_id" (openedChange)="ubSalidaSearch.value = null">
                            <mat-form-field appearance="legacy" style="padding: 0.8em;">
                              <input (input)="gf.ub_salida_id.patchValue($event.target['value'])" matInput
                                     placeholder="Buscador" autocomplete="off" #ubSalidaSearch>
                              <button mat-icon-button matSuffix
                                      (click)="ubSalidaSearch.value = null; gf.ub_salida_id.patchValue('')">
                                <mat-icon>clear</mat-icon>
                              </button>
                            </mat-form-field>
                            <mat-option *ngFor="let ubicacion of exitPlacesOptions$ | async" [value]="ubicacion.id">
                              {{(ubicacion.alias) ? ubicacion.alias : ubicacion.direccion}}
                            </mat-option>
                          </mat-select>

                          <mat-error *ngIf="gf.ub_salida_id.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col> <!-- Lugar de salida -->
                      <ion-col size="12" size-md="6">
                        <mat-form-field appearance="legacy">
                          <mat-label>Lugar de retorno</mat-label>
                          <mat-select formControlName="ub_retorno_id" (openedChange)="ubRetornoSearch.value = null">
                            <mat-form-field appearance="legacy" style="padding: 0.8em">
                              <input type="text" matInput (input)="gf.ub_retorno_id.patchValue($event.target['value'])"
                                     placeholder="Buscador" autocomplete="off" #ubRetornoSearch>
                              <button mat-icon-button matSuffix
                                      (click)="ubRetornoSearch.value = null; gf.ub_retorno_id.patchValue('')">
                                <mat-icon>clear</mat-icon>
                              </button>
                            </mat-form-field>
                            <mat-option *ngFor="let ubicacion of returnPlacesOptions$ | async" [value]="ubicacion.id">
                              {{(ubicacion.alias) ? ubicacion.alias : ubicacion.direccion}}
                            </mat-option>
                          </mat-select>
                          <mat-error *ngIf="gf.ub_retorno_id.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>
                      </ion-col> <!-- Lugar de retorno -->
                    </ion-row> <!-- Ubicacion de salida y retorno -->
                    <mat-divider></mat-divider>
                    <ion-row>
                      <ng-container>
                        <ion-col size="12">
                          <mat-slide-toggle [(ngModel)]="useCalendar" [ngModelOptions]="{standalone: true}">
                            Usar calendario
                          </mat-slide-toggle>
                        </ion-col>  <!-- toogle usar calendario -->

                        <ion-col size="12" size-md="4" *ngIf="useCalendar === false">
                          <mat-form-field appearance="legacy">
                            <mat-label>Días de renta</mat-label>
                            <input type="number" max="30" #totalDays matInput formControlName="total_dias"
                                   (input)="setReturnDateChange(totalDays.value, true)">
                            <span matSuffix>{{(gf.total_dias.value > 1 ? 'días' : 'día')}}</span>
                            <mat-hint style="font-size: 1.1em"
                                      *ngIf="rangoFechas.fecha_retorno.value && rangoFechas.fecha_salida.value">
                              <mat-icon style="font-size: 1.1em; vertical-align: middle;">event</mat-icon>
                              {{dateConv.transFormDate(rangoFechas.fecha_salida.value, 'slash')}} -
                              {{dateConv.transFormDate(rangoFechas.fecha_retorno.value, 'slash')}}
                            </mat-hint>
                          </mat-form-field>
                        </ion-col> <!-- Días de renta -->

                        <ion-col size="12" size-md="4" *ngIf="useCalendar === true">
                          <mat-form-field appearance="legacy">
                            <mat-label>Fecha salida - retorno</mat-label>
                            <mat-date-range-input [rangePicker]="fechaRetornoRegreso" [formGroup]="rangoFechasGroup"
                                                  [min]="_today" [max]="_maxDate">
                              <input matStartDate formControlName="fecha_salida" placeholder="Start date" readonly
                                     autocomplete="off" (dateChange)="startDateChange()">
                              <input matEndDate formControlName="fecha_retorno" placeholder="End date"
                                     (dateChange)="setReturnDateChange()" readonly autocomplete="off">
                            </mat-date-range-input>
                            <mat-datepicker-toggle matSuffix [for]="fechaRetornoRegreso"></mat-datepicker-toggle>
                            <mat-date-range-picker #fechaRetornoRegreso></mat-date-range-picker>
                            <mat-hint>{{gf.total_dias.value}} {{(gf.total_dias.value > 1) ? 'días' : 'dia'}}</mat-hint>
                            <mat-error *ngIf="rangoFechas.fecha_salida.errors?.required">La fecha de salida es
                              obligatoria
                            </mat-error>
                            <mat-error *ngIf="rangoFechas.fecha_retorno.errors?.required">La fecha de retorno es
                              obligatoria
                            </mat-error>
                          </mat-form-field>
                        </ion-col> <!-- Dias de renta date range picker -->
                      </ng-container> <!-- Días de renta group -->

                      <ion-col size="12" size-md="4">
                        <mat-form-field appearance="legacy">
                          <mat-label>Tipo Tarifa</mat-label>
                          <mat-select #tipoTarifa (selectionChange)="initTipoTarifaRule();"
                                      formControlName="tipo_tarifa">
                            <mat-option *ngFor="let tarifa of tiposTarifas"
                                        [value]="tarifa.tarifa">{{tarifa.tarifa}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </ion-col> <!-- tipo de tarifa picker -->

                      <ion-col size="12" size-md="4">
                        <mat-form-field appearance="legacy" *ngIf="gf.tipo_tarifa.value !== 'Hotel'">
                          <mat-label>Categoría Vehículo</mat-label>
                          <mat-select (selectionChange)="setTarifasCat(true)" formControlName="tarifa_modelo_id">
                            <mat-option *ngFor="let tarifaCat of tarifasCategorias"
                                        [value]="tarifaCat.id">{{tarifaCat.categoria}}</mat-option>
                          </mat-select>
                          <mat-error *ngIf="gf.tarifa_modelo_id.errors?.required">Este campo es requerido</mat-error>
                        </mat-form-field> <!-- Tarifa x Categoría -->

                        <mat-form-field appearance="legacy" *ngIf="gf.tipo_tarifa.value === 'Hotel'">
                          <mat-label>Hotel</mat-label>
                          <mat-select formControlName="modelo_id" (selectionChange)="loadHotelTarifas(true)">
                            <mat-option *ngFor="let hotel of hoteles" [value]="hotel.id">{{hotel.nombre}}</mat-option>
                          </mat-select>
                          <mat-error *ngIf="gf.modelo_id.errors?.required">Campo requerido</mat-error>
                        </mat-form-field>  <!-- Hotel -->

                      </ion-col> <!-- Categoría vehículo | clase vehiculo -->
                    </ion-row> <!-- Días de renta | tarifa x categoría | tipo tarifa -->

                    <ion-row>
                      <ion-col size="12" size-md="4">
                        <mat-form-field appearance="legacy">
                          <mat-label>Extras</mat-label>
                          <mat-select [multiple]="true" (selectionChange)="pushSelectedExtras()"
                                      formControlName="cobros_extras_ids">
                            <mat-option *ngFor="let extras of tarifasExtras"
                                        [value]="extras.id">{{extras.nombre}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                      </ion-col> <!-- Extras -->

                      <ng-container *ngIf="gf.tipo_tarifa.value === 'Hotel'">
                        <ion-col size="12" size-md="4">
                          <mat-form-field appearance="legacy" *ngIf="gf.tipo_tarifa.value == 'Hotel'">
                            <mat-label>Vehículo Clase</mat-label>
                            <mat-select formControlName="vehiculo_clase_id"
                                        (selectionChange)="setVehiculoClaseData(true)">
                              <mat-option *ngFor="let clase of tarifasHotel"
                                          [value]="clase.clase_id">{{clase.clase}}</mat-option>
                            </mat-select>
                            <mat-error></mat-error>
                          </mat-form-field> <!-- clase vehiculo -->
                        </ion-col>

                        <ion-col size="12" size-md="4" class="ion-text-center">
                          <ion-col size="12" name="extra-form">
                            <mat-form-field appearance="legacy">
                              <mat-label>Folio Cupón</mat-label>
                              <input matInput type="text" autocomplete="off" formControlName="folio_cupon" maxlength="50">
                              <mat-error></mat-error>
                            </mat-form-field>
                          </ion-col>
                          <app-modelos-docs model="contratos" docType="cupon" btnSize="small" [fullSize]="true"
                                            [justButton]="true" [model_id_value]="contract_id">

                          </app-modelos-docs>

                        </ion-col>  <!-- Folio cupón -->
                      </ng-container>  <!-- Hotel | Folio cupón -->


                      <ng-container *ngIf="gf.tipo_tarifa.value === 'Comisionista'">
                        <ion-col size="12" size-md="4">
                          <mat-form-field appearance="legacy">
                            <mat-label>Comisionista</mat-label>
                            <mat-select formControlName="modelo_id" (selectionChange)="setComisiones(true)">
                              <mat-option *ngFor="let comisionista of comisionistas"
                                          [value]="comisionista.id">{{comisionista.nombre}} {{comisionista.apellidos}}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="gf.modelo_id.errors?.required">Campo requerido</mat-error>
                          </mat-form-field><!-- modelo_id -->
                        </ion-col>
                        <ion-col size="12" size-md="4">
                          <mat-form-field appearance="legacy">
                            <mat-label>Cantidad Comisión</mat-label>
                            <mat-select formControlName="comision" (selectionChange)="initCalcComisionista();">
                              <mat-option *ngFor="let comision of comisiones"
                                          [value]="comision">{{comision}}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="gf.comision.errors?.required">Campo requerido</mat-error>
                          </mat-form-field> <!-- comision -->
                        </ion-col>
                      </ng-container> <!-- Comisionista: | modelo_id | comision -->
                    </ion-row>

                    <mat-divider></mat-divider>

                    <ion-row>
                      <ion-col size="12" size-md="6">
                        <ion-row>
                          <ion-col size="12">
                            <div class="datos-generales-precioU">
                              <h2>Valor unitario x día</h2>
                              <p>{{(gf.precio_unitario_final && gf.precio_unitario_final.value ? (gf.precio_unitario_final.value | currency) : '--')}}</p>
                            </div>
                          </ion-col> <!-- precio unitario -->
                          <ion-col size="12" class="ion-text-center ion-align-self-center">
                            <div
                              style="display: flex; flex-direction: column; align-items: flex-start; padding-left: 12px">
                              <mat-checkbox
                                class="example-margin"
                                [labelPosition]="'after'"
                                (change)="makeCalc()"
                                formControlName="con_iva"
                              >
                                Aplicar IVA ?
                              </mat-checkbox>
                              <mat-checkbox
                                class="example-margin"
                                [labelPosition]="'after'"
                                (change)="makeCalc()"
                                formControlName="con_descuento"
                                *ngIf="gf.tipo_tarifa.value !== 'Hotel'"
                              >
                                Aplicar Descuento ?
                              </mat-checkbox>
                            </div>
                            <mat-form-field
                              *ngIf="gf.tipo_tarifa.value !== 'Hotel' && (gf.con_descuento.value == 1 || gf.con_descuento.value == true)">
                              <mat-label>Descuento %</mat-label>
                              <mat-select formControlName="tarifa_apollo_id" (selectionChange)="makeCalc()">
                                <ng-container *ngFor="let confDes of selectedTarifaCat.tarifas">
                                  <mat-option *ngIf="confDes.ap_descuento" [value]="confDes.id"
                                              [disabled]="confDes.enable === false">{{confDes.valor_descuento}}</mat-option>
                                </ng-container>

                              </mat-select>
                              <mat-error *ngIf="gf.tarifa_apollo_id.errors?.required">Este campo es requerido
                              </mat-error>
                            </mat-form-field> <!-- cantidad de descuento -->

                          </ion-col> <!-- aplicar IVA | aplicar descuento -->
                        </ion-row>
                      </ion-col> <!-- precio unitario | aplicar IVA | aplicar descuento -->

                      <ion-col size="12" size-md="6">
                        <div style="text-align: center">
                          <p style="margin: 0; padding: 1rem;">Desgloce Cobro</p>
                          <small *ngIf="cobranzaI && cobranzaI.length === 0">En espera para iniciar calculo ....</small>
                        </div>
                        <table class="desgloce-cobro-table" *ngIf="cobranzaI && cobranzaI.length > 0">
                          <thead>
                          <tr>
                            <th></th>
                            <th>Monto</th>
                            <th>Cantidad</th>
                            <th>Costo MXN</th>
                          </tr>
                          </thead>
                          <tbody>
                          {{getExtraRows()}}
                          <ng-container *ngFor="let cobranza of cobranzaI; let i = index">
                            <tr *ngIf=" cobranza.element !== 'extra'"
                                [ngClass]="{'total-row': cobranza.element === 'total'}">
                              <td>{{cobranza.element_label}}</td>
                              <td>{{cobranza.value | currency}}</td>
                              <td>{{cobranza.quantity}} {{cobranza.quantity_type}}</td>
                              <td>{{(cobranza.number_sign === 'negative' ? '-' : '')}} {{cobranza.amount | currency}}</td>
                            </tr>
                            <ng-container *ngIf="cobranza.element == 'extra'">
                              <tr class="extra-row">
                                <td>Extras</td>
                                <td colspan="3"></td>
                              </tr>
                              <tr>
                                <td>{{cobranza.element_label}}</td>
                                <td>{{cobranza.value | currency}}</td>
                                <td>
                                  <div class="table-input">
                                    <div style="display: flex;align-items: center;">
                                      <input type="number" autocomplete="off" [(ngModel)]="cobranza.quantity"
                                             (ngModelChange)="makeCalc('extra', cobranza)"
                                             [ngModelOptions]="{standalone: true}">
                                      <span>x {{gf.total_dias.value}} días</span>
                                    </div>

                                  </div>
                                </td>
                                <td>{{(cobranza.number_sign === 'negative' ? '-' : '')}} {{cobranza.amount | currency}}</td>
                              </tr>
                            </ng-container>
                          </ng-container>

                          </tbody>
                        </table>
                      </ion-col> <!-- desbloce de cobro -->
                    </ion-row> <!-- precio unitario | aplicar IVA | aplicar descuento | desbloce de cobro -->

                  </ion-card-content>
                  <div class="card-action-buttons">
                    <ion-button color="success" (click)="saveProcess('datos_generales')">SIGUIENTE</ion-button>
                  </div>
                </ion-card>

              </form>
            </mat-expansion-panel>
          </div>
        </mat-accordion> <!-- Datos Generales -->
        <mat-accordion *ngIf="!contractData || (contractData && contractData.estatus != 2 )">
          <div class="accordion-margin">
            <mat-expansion-panel [expanded]="step === 2" hideToggle [disabled]="step == 1 || step == 0">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Datos Vehículo
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="car"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <ion-card [disabled]="step >= 4 && contractData.estatus !== 4">
                <ion-card-content>
                  <ion-row>
                    <ion-col size="12">
                      <form *ngIf="vehiculoData" [formGroup]="vehiculoForm">
                        <ion-row>
                          <ion-col size="12">
                            <div class="search-row-buttons">
                              <ion-button size="small" color="secondary"
                                          (click)="openModalSearch('vehiculos', 'vehiculo')">
                                <ion-icon name="search"></ion-icon>
                              </ion-button>
                            </div>
                          </ion-col>
                        </ion-row> <!-- openModalSearch -->
                        <ion-row class="ion-no-padding ion-no-margin">
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Código Vehículo</mat-label>
                              <input type="text" autocomplete="off" maxlength="50" matInput [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.codigo ? vehiculoData.codigo : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Código Vehículo-->
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Marca</mat-label>
                              <input type="text" matInput autocomplete="off" maxlength="50" [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.marca && vehiculoData.marca.marca ? vehiculoData.marca.marca : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Marca-->
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Modelo</mat-label>
                              <input type="text" autocomplete="off" maxlength="50" matInput [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.modelo ? vehiculoData.modelo : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Modelo-->
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Color</mat-label>
                              <input type="text" matInput maxlength="20" autocomplete="off" [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.color ? vehiculoData.color : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Color-->
                        </ion-row> <!-- Código Vehículo  Marca  Modelo  Color -->
                        <ion-row class="ion-no-padding ion-no-margin">
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>No. Placas</mat-label>
                              <input type="text" matInput maxlength="10" autocomplete="off" [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.placas ? vehiculoData.placas : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--No. Placas-->
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>No. Serie</mat-label>
                              <input type="text" matInput maxlength="40" autocomplete="off" [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.num_serie ? vehiculoData.num_serie : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--No. Serie-->
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>No. Poliza</mat-label>
                              <input type="text" matInput maxlength="30" autocomplete="off" [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.num_poliza_seg ? vehiculoData.num_poliza_seg : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>  <!--Poliza-->
                          </ion-col>
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>Capacidad Tanque</mat-label>
                              <input type="number" autocomplete="off" matInput [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.cap_tanque ? vehiculoData.cap_tanque : null"
                                     style="text-align: right;">
                              <span matSuffix>LT</span>
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Capacidad Tanque-->
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>Cant. Combustible anterior</mat-label>
                              <input formControlName="cant_combustible_anterior" autocomplete="off" type="number" matInput [disabled]="true"
                                     [value]="vehiculoData && vehiculoData.cant_combustible_anterior ? vehiculoData.cant_combustible_anterior : null"
                                     style="text-align: right;">
                              <span matSuffix>LT</span>
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Capacidad Tanque-->
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>Cant. Combustible Salida</mat-label>
                              <mat-select formControlName="cant_combustible_salida">
                                <mat-option value="1/8">1/8</mat-option>
                                <mat-option value="2/8">2/8</mat-option>
                                <mat-option value="3/8">3/8</mat-option>
                                <mat-option value="4/8">4/8</mat-option>
                                <mat-option value="5/8">5/8</mat-option>
                                <mat-option value="6/8">6/8</mat-option>
                                <mat-option value="7/8">7/8</mat-option>
                                <mat-option value="8/8">8/8</mat-option>
                              </mat-select>
                              <mat-error *ngIf="vf.cant_combustible_salida.errors?.required">Campo requerido</mat-error>
                              <mat-hint *ngIf="vf.cant_combustible_salida.disabled">Solo lectura</mat-hint>
                            </mat-form-field> <!-- Cant. Combustible salida -->
                          </ion-col>
                          <ion-col size size-md="6">
                            <mat-form-field appearance="legacy">
                              <mat-label>Km. Anterior</mat-label>
                              <input matInput type="number" formControlName="km_anterior" autocomplete="off">
                            </mat-form-field> <!-- Km. Anterior-->
                            <mat-hint>Solo lectura</mat-hint>
                          </ion-col>
                          <ion-col size size-md="6">
                            <mat-form-field appearance="legacy">
                              <mat-label>Km. Inicio</mat-label>
                              <input matInput type="number" formControlName="km_inicial" autocomplete="off">
                              <mat-error *ngIf="vf.km_inicial.errors?.required">Campo requerido</mat-error>
                              <mat-hint *ngIf="vf.km_inicial.disabled">Solo lectura</mat-hint>
                            </mat-form-field> <!-- Km. Inicio-->
                          </ion-col>
                        </ion-row> <!-- No. Placas  No.Serie  Capacidad Tanque  -->

                        <div class="card-action-buttons">
                          <ion-button color="success" (click)="saveProcess('datos_vehiculo')">SIGUIENTE</ion-button>
                        </div>
                      </form>
                      <div *ngIf="!vehiculoData">
                        <ion-row>
                          <ion-col size="12">
                            <div class="ion-text-center">
                              Seleccione un vehículo
                              &nbsp;
                              <ion-button size="small" color="secondary"
                                          (click)="openModalSearch('vehiculos', 'vehiculo')">
                                <ion-icon name="search"></ion-icon>
                              </ion-button>
                            </div>
                          </ion-col>
                        </ion-row> <!-- openModalSearch -->
                      </div>
                    </ion-col> <!-- datos vehiculo -->
                  </ion-row>
                </ion-card-content>
              </ion-card>
            </mat-expansion-panel>
          </div>
        </mat-accordion> <!-- Datos vehiculo -->
        <mat-accordion *ngIf="!contractData || (contractData && contractData.estatus != 2 )">
          <div class="accordion-margin">
            <mat-expansion-panel [expanded]="step === 3" hideToggle [disabled]="step == 0 || step == 1 || step == 2">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Cobranza
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="wallet"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <ion-card [disabled]="step >= 6  && contractData.estatus !== 4">
                <ion-card-content>
                  <h4 style="font-weight: 500">DESCRIPCION DE LOS CARGOS Y PRE-AUTORIZACIONES</h4>
                  <br>
                  <mat-divider></mat-divider>
                  <br>
                  <ion-row>
                    <ion-col size="6">
                      <h4 style="margin: 0; padding: 0;">Total: <span
                        style="color: var(--ion-color-success)">{{(generalDataForm && generalDataForm.controls.total.value) ? (generalDataForm.controls.total.value | currency) + ' ' + baseCurrency : '--'}}</span>
                      </h4>
                      <h4 style="margin: 0; padding: 0;">Balance por saldar: <span
                        [ngClass]="{'danger-color': balancePorPagar > 0}">{{(balancePorPagar) ? (balancePorPagar | currency) + ' ' + baseCurrency : ('0' | currency) + ' ' + baseCurrency}}</span>
                      </h4>
                    </ion-col>
                    <ion-col size="6" class="ion-text-end">
                      <button mat-raised-button class="button-secondary" (click)="agregarPagoOpt('salida')">
                        <span style="font-size: 1.3rem;margin-right: 0.5rem;">+</span>&nbsp;Cobro&nbsp;<ion-icon
                        name="wallet"></ion-icon>
                      </button>
                    </ion-col>
                  </ion-row>
                  <br>
                  <ion-row>
                    <ion-col size="12" size-md="6">
                      <ion-card style="margin: 0;">
                        <ion-card-content>
                          <div class="accordion-title">
                            <span class="icon">
                               <ion-icon name="checkmark-circle"
                                         [color]="(balancePorPagar <= 0) ? 'success': ''"></ion-icon>
                            </span>
                            <span>
                              Pagado
                            </span>
                            <span>
                              ${{pagadoTotal | currency}} {{baseCurrency}}
                            </span>
                          </div>

                          <mat-accordion>
                            <ng-container *ngFor="let cobranzaPago of cobranzaProgData">
                              <mat-expansion-panel style="margin-top: 1rem"
                                                   *ngIf="cobranzaPago.tipo === cobranzaTipos.PAGOTARJETA">
                                <mat-expansion-panel-header>
                                  <mat-panel-title>
                                    Tarjeta
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    <div class="tarjeta-resume">
                                  <span class="tipo-tarjeta">
                                    {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}
                                  </span>
                                      <span>
                                    {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_cn4) ? cobranzaPago.tarjeta.c_cn4 : '--'}}
                                  </span>
                                      <span>
                                       {{(cobranzaPago.monto_cobrado) ? (cobranzaPago.monto_cobrado | currency) : ('0' | currency) }} {{cobranzaPago.moneda_cobrada}}
                                  </span>
                                    </div>
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <ion-row class="border-ion-row">
                                  <ion-col size="12" *ngIf="cobranzaPago.tipo_cambio && cobranzaPago.tipo_cambio_id">
                                    <div style="display: flex; justify-content: space-between;">
                                      <span>Tipo Cambio</span>
                                      <span>1 {{cobranzaPago.moneda_cobrada}}
                                        = {{cobranzaPago.tipo_cambio}} {{cobranzaPago.moneda}}</span>
                                    </div>
                                  </ion-col>
                                  <ion-col size="12">
                                    <ion-row>
                                      <ion-col size="fill">
                                        <div class="action-buttons">
                                          <button *ngIf="cobranzaPago.id && cobranzaPago.edit !== true"
                                                  (click)="cancelCobro(cobranzaPago, 'salida')" class="mat-elevation-z0"
                                                  mat-mini-fab color="warn">
                                            <mat-icon>remove</mat-icon>
                                          </button>
                                          <button *ngIf="cobranzaPago.edit !== true && cobranzaPago.id"
                                                  (click)="editCobro(cobranzaTipos.PAGOTARJETA, 'salida', cobranzaPago)"
                                                  style="margin-top: 10px" class="mat-elevation-z0" mat-mini-fab
                                                  color="accent">
                                            <mat-icon>edit</mat-icon>
                                          </button>
                                        </div>
                                      </ion-col>
                                      <ion-col size>
                                        <div class="info-card">
                                          <div class="info-row">
                                            <span>Tipo Tarjeta: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Num. Tarjeta: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_cn1 && cobranzaPago.tarjeta.c_cn4)) ? cobranzaPago.tarjeta.c_cn1 + '*' + cobranzaPago.tarjeta.c_cn4 : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Mes / Año: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_month && cobranzaPago.tarjeta.c_year)) ? cobranzaPago.tarjeta.c_month + '/' + cobranzaPago.tarjeta.c_year : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Aprobación Banco: </span>
                                            <p>
                                              {{cobranzaPago.cod_banco}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Monto: </span>
                                            <p>
                                              {{cobranzaPago.monto_cobrado | currency}} {{cobranzaPago.moneda_cobrada}}
                                            </p>
                                          </div>
                                        </div>
                                      </ion-col>
                                    </ion-row>
                                  </ion-col>
                                  <ion-col size="12" class="ion-no-padding">
                                    <app-modelos-docs model="cobranza" docType="voucher" btnSize="small"
                                                      [justButton]="true" [fullSize]="true"
                                                      [model_id_value]="cobranzaPago.id">
                                      <legend name="legend">Img. Voucher</legend>
                                    </app-modelos-docs>
                                  </ion-col>
                                </ion-row>
                              </mat-expansion-panel>
                              <mat-expansion-panel style="margin-top: 1rem"
                                                   *ngIf="cobranzaPago.tipo === cobranzaTipos.PAGOEFECTIVO">
                                <mat-expansion-panel-header #panelH>
                                  <mat-panel-title>
                                    Efectivo
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    <div class="tarjeta-resume">
                                      <span style="padding-right: 0.5em">
                                        {{cobranzaPago.monto_cobrado | currency}} {{cobranzaPago.moneda_cobrada}}
                                      </span>
                                    </div>
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <ion-row>
                                  <ion-col size="12" *ngIf="cobranzaPago.tipo_cambio && cobranzaPago.tipo_cambio_id">
                                    <div style="display: flex; justify-content: space-between;">
                                      <span>Tipo Cambio</span>
                                      <span>1 {{cobranzaPago.moneda_cobrada}}
                                        = {{cobranzaPago.tipo_cambio}} {{cobranzaPago.moneda}}</span>
                                    </div>
                                  </ion-col>
                                  <ion-col size="12">
                                    <div style="display: flex; justify-content: space-evenly;">
                                      <button *ngIf="cobranzaPago.id && cobranzaPago.edit !== true"
                                              (click)="cancelCobro(cobranzaPago, 'salida')" class="mat-elevation-z0"
                                              mat-mini-fab color="warn">
                                        <mat-icon>remove</mat-icon>
                                      </button>
                                      <button *ngIf="cobranzaPago.edit !== true && cobranzaPago.id"
                                              (click)="editCobro(cobranzaTipos.PAGOEFECTIVO, 'salida' ,cobranzaPago)"
                                              class="mat-elevation-z0" mat-mini-fab color="accent">
                                        <mat-icon>edit</mat-icon>
                                      </button>
                                    </div>
                                  </ion-col>
                                </ion-row>

                              </mat-expansion-panel>
                            </ng-container>

                          </mat-accordion>
                        </ion-card-content>
                      </ion-card>

                    </ion-col>
                    <ion-col size="12" size-md="6">
                      <ion-card style="margin: 0;">
                        <ion-card-content>
                          <div class="accordion-title">
                        <span class="icon">
                          <ion-icon name="checkmark-circle" [color]="(pagadoAutTotal > 0) ? 'success': ''"></ion-icon>
                        </span>
                            <span>
                          Pre autorización
                        </span>
                            <span>
                          ${{pagadoAutTotal | currency}} {{baseCurrency}}
                        </span>
                          </div>

                          <mat-accordion>
                            <ng-container *ngFor="let cobranzaAuth of cobranzaProgData">
                              <mat-expansion-panel *ngIf="cobranzaAuth.tipo === cobranzaTipos.PREAUTHORIZACION">
                                <mat-expansion-panel-header>
                                  <mat-panel-title>
                                    Tarjeta
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    <div class="tarjeta-resume">
                                  <span class="tipo-tarjeta">
                                    {{(cobranzaAuth.tarjeta && cobranzaAuth.tarjeta.c_type) ? cobranzaAuth.tarjeta.c_type : '--'}}
                                  </span>
                                      <span>
                                    {{(cobranzaAuth.tarjeta && cobranzaAuth.tarjeta.c_cn4) ? cobranzaAuth.tarjeta.c_cn4 : '--'}}
                                  </span>
                                      <span>
                                       {{(cobranzaAuth.monto_cobrado) ? (cobranzaAuth.monto_cobrado | currency) : ('0' | currency) }} {{cobranzaAuth.moneda_cobrada}}
                                  </span>
                                    </div>
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <ion-row class="border-ion-row">
                                  <ion-col size="12" *ngIf="cobranzaAuth.tipo_cambio && cobranzaAuth.tipo_cambio_id">
                                    <div style="display: flex; justify-content: space-between;">
                                      <span>Tipo Cambio</span>
                                      <span>1 {{cobranzaAuth.moneda_cobrada}}
                                        = {{cobranzaAuth.tipo_cambio}} {{cobranzaAuth.moneda}}</span>
                                    </div>
                                  </ion-col>
                                  <ion-col size="12">
                                    <ion-row>
                                      <ion-col size="fill">
                                        <div class="action-buttons">
                                          <button *ngIf="cobranzaAuth.id && cobranzaAuth.edit !== true"
                                                  (click)="cancelCobro(cobranzaAuth, 'salida')" class="mat-elevation-z0"
                                                  mat-mini-fab color="warn">
                                            <mat-icon>remove</mat-icon>
                                          </button>
                                          <button *ngIf="cobranzaAuth.edit !== true && cobranzaAuth.id"
                                                  (click)="editCobro(cobranzaTipos.PREAUTHORIZACION, 'salida', cobranzaAuth)"
                                                  style="margin-top: 10px" class="mat-elevation-z0" mat-mini-fab
                                                  color="accent">
                                            <mat-icon>edit</mat-icon>
                                          </button>
                                        </div>
                                      </ion-col>
                                      <ion-col size>
                                        <div class="info-card">
                                          <div class="info-row">
                                            <span>Tipo Tarjeta: </span>
                                            <p>
                                              {{(cobranzaAuth.tarjeta && cobranzaAuth.tarjeta.c_type) ? cobranzaAuth.tarjeta.c_type : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Num. Tarjeta: </span>
                                            <p>
                                              {{(cobranzaAuth.tarjeta && (cobranzaAuth.tarjeta.c_cn1 && cobranzaAuth.tarjeta.c_cn4)) ? cobranzaAuth.tarjeta.c_cn1 + '*' + cobranzaAuth.tarjeta.c_cn4 : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Mes / Año: </span>
                                            <p>
                                              {{(cobranzaAuth.tarjeta && (cobranzaAuth.tarjeta.c_month && cobranzaAuth.tarjeta.c_year)) ? cobranzaAuth.tarjeta.c_month + '/' + cobranzaAuth.tarjeta.c_year : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Aprobación Banco: </span>
                                            <p>
                                              {{cobranzaAuth.cod_banco}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Monto: </span>
                                            <p>
                                              {{cobranzaAuth.monto_cobrado | currency}} {{cobranzaAuth.moneda_cobrada}}
                                            </p>
                                          </div>
                                        </div>
                                      </ion-col>
                                    </ion-row>
                                  </ion-col>
                                  <ion-col size="12" class="ion-no-padding">
                                    <app-modelos-docs model="cobranza" docType="voucher" btnSize="small"
                                                      [justButton]="true" [fullSize]="true"
                                                      [model_id_value]="cobranzaAuth.id">
                                      <legend name="legend">Img. Voucher</legend>
                                    </app-modelos-docs>
                                  </ion-col>
                                </ion-row>
                              </mat-expansion-panel>
                            </ng-container>

                          </mat-accordion>
                        </ion-card-content>

                      </ion-card>

                    </ion-col>
                  </ion-row> <!-- Pagado | PreAutorización -->

                </ion-card-content>
                <div class="card-action-buttons">
                  <ion-button color="success" *ngIf="balancePorPagar <= 0 && pagadoAutTotal > 0" (click)="nextStep()">
                    SIGUIENTE
                  </ion-button>
                </div>

              </ion-card>
            </mat-expansion-panel>
          </div>
        </mat-accordion> <!-- COBRANZA Detalle cargos y pre-autorizaciones -->
        <mat-accordion *ngIf="!contractData || (contractData && contractData.estatus != 2 )">
          <div class="accordion-margin">
            <mat-expansion-panel [expanded]="step === 4" hideToggle
                                 [disabled]="step == 0 || step == 1 || step == 2 || step == 3">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Check List - Salida
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="checkmark-circle"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <ion-card [disabled]="step >= 6">
                <ion-card-content>
                  <ion-row (loadeddata)="initReviewCanva()">
                    <ion-col size="12" id="revisionRowW" style="overflow:scroll;">

                      <div class="checklist-top-buttons">

                        <div class="top-button">
                          <button class="button-blue-light" mat-raised-button
                                  (click)="addDraggedBtn('radio_button_unchecked', 'Abolladura')">
                            <mat-icon>radio_button_unchecked</mat-icon>
                          </button>
                          <span>Abolladura</span>
                        </div>

                        <div class="top-button">
                          <button class="button-blue-light" mat-raised-button
                                  (click)="addDraggedBtn('horizontal_rule', 'Rayon')">
                            <mat-icon>horizontal_rule</mat-icon>
                          </button>
                          <span>Rayon</span>
                        </div>

                        <div class="top-button">
                          <button class="button-blue-light" mat-raised-button
                                  (click)="addDraggedBtn('close', 'Golpes')">
                            <mat-icon>close</mat-icon>
                          </button>
                          <span>Golpes</span>
                        </div>

                        <div class="top-button">
                          <button class="button-blue-light" mat-raised-button
                                  (click)="addDraggedBtn('change_history', 'Rotura')">
                            <mat-icon>change_history</mat-icon>
                          </button>
                          <span>Rotura</span>
                        </div>
                      </div>
                      <br>
                    </ion-col>
                    <ion-col size="12" class="ion-text-center">
                      <mat-error *ngIf="selectedDragObj && !selectedDragObj.saved">** Recuerde guardar su avance **
                      </mat-error>
                    </ion-col>
                    <ion-col size="12" size-md="2" class="ion-text-center">
                      <button *ngIf="selectedDragObj && !selectedDragObj.saved" mat-raised-button class="button-success"
                              (click)="saveCheckListDB()">Guardar
                      </button>

                      <div class="checklist-left-buttons" *ngIf="selectedDragObj && selectedDragObj.enable === true">

                        <div class="draggid">
                          <span><b>Check Id:</b></span> &nbsp;
                          <span>{{selectedDragObj.objId}}</span>
                        </div>
                        <button mat-raised-button class="button-cancel" title="Cancelar"
                                (click)="cancelActionDragObj(this.selectedDragObj)">
                          <mat-icon>highlight_off</mat-icon>
                        </button>
                        <button *ngIf="!selectedDragObj.lock" mat-raised-button class="button-blue-light"
                                title="Bloquear" (click)="blockUnblockDragObj(this.selectedDragObj, true)">
                          <mat-icon>lock_open</mat-icon>
                        </button>
                        <button *ngIf="selectedDragObj.lock" mat-raised-button class="button-blue-light"
                                title="Desbloquear" (click)="blockUnblockDragObj(this.selectedDragObj, false)">
                          <mat-icon>lock</mat-icon>
                        </button>
                        <button mat-raised-button color="warn" title="Quitar" (click)="removeDragObj(selectedDragObj)">
                          <mat-icon>delete_outline</mat-icon>
                        </button>
                        <button mat-raised-button class="button-blue-light" title="Capturar foto"
                                (click)="openModelosDocModal(selectedDragObj)">
                          <mat-icon>photo_camera</mat-icon>
                        </button>
                        <button mat-raised-button class="button-blue-light" title="Agregar nota"
                                (click)="addNote(selectedDragObj)">
                          <mat-icon>text_snippet</mat-icon>
                        </button>
                        <button mat-raised-button class="button-blue-light" title="Ver más" (click)="openFullView()">
                          <mat-icon>visibility</mat-icon>
                        </button>
                      </div>
                    </ion-col>
                    <ion-col size="12" size-md="10" style="overflow: scroll" id="drag-container">
                      <div style="position: relative; margin: 0 auto" [style.width.px]="816" id="check-list-canvas">
                        <ion-img src="assets/img/svg/vehicle-outline/sedan.png" *ngIf="!vehicleOutlineBackground"
                                 [style.width.px]="816"></ion-img>
                        <ng-container *ngIf="externalLayoutPresent">
                          <ion-img *ngIf="vehicleOutlineBackground" src="{{vehicleOutlineBackground}}"
                                   [style.width.px]="816"></ion-img>
                        </ng-container>
                        <ng-container *ngIf="!externalLayoutPresent">
                          <ion-img *ngIf="vehicleOutlineBackground"
                                   src="assets/img/svg/vehicle-outline/{{vehicleOutlineBackground}}.png"
                                   [style.width.px]="816"></ion-img>
                        </ng-container>

                        <div class="checklist-inspector-zone">
                          <app-draggable-resizable *ngFor="let dragObj of dragObjs"
                                                   (dragObjSaved)="saveDragObj($event)"
                                                   (dragObjSelected)="catchPickedObj($event)"
                                                   [draggableObj]="dragObj"
                                                   [objLimitWidth]="816"
                                                   [objLimitHeight]="816"
                                                   [contract_id]="contract_id"
                                                   [type]="0"
                          >
                          </app-draggable-resizable>
                        </div>
                      </div>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="12">
                      <form [formGroup]="checkListForm" *ngIf="checkListForm">
                        <ion-row>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Tarjeta de circulación</mat-label>
                              <mat-select formControlName="tarjeta_circulacion">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Tapetes</mat-label>
                              <mat-select formControlName="tapetes">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                                <mat-option value="3">3</mat-option>
                                <mat-option value="4">4</mat-option>
                                <mat-option value="5">5</mat-option>
                                <mat-option value="6">6</mat-option>
                                <mat-option value="7">7</mat-option>
                                <mat-option value="8">8</mat-option>
                                <mat-option value="9">9</mat-option>
                                <mat-option value="10">10</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Espejos</mat-label>
                              <mat-select formControlName="espejos">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                                <mat-option value="3">3</mat-option>
                              </mat-select>

                            </mat-form-field>
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Tapones de ruedas</mat-label>
                              <mat-select formControlName="tapones_rueda">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                                <mat-option value="3">3</mat-option>
                                <mat-option value="4">4</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Tapón de gas</mat-label>
                              <mat-select formControlName="tapon_gas">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Señalamientos</mat-label>
                              <mat-select formControlName="senalamientos">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Gato</mat-label>
                              <mat-select formControlName="gato">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Llave de ruedas</mat-label>
                              <mat-select formControlName="llave_rueda">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Limpiadores</mat-label>
                              <mat-select formControlName="limpiadores">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                                <mat-option value="3">3</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Antena</mat-label>
                              <mat-select formControlName="antena">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Navegador</mat-label>
                              <mat-select formControlName="navegador">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Placas</mat-label>
                              <mat-select formControlName="placas">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Radio</mat-label>
                              <mat-select formControlName="radio">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <mat-label>Llantas</mat-label>
                              <mat-select formControlName="llantas">
                                <mat-option value="0">0</mat-option>
                                <mat-option value="1">1</mat-option>
                                <mat-option value="2">2</mat-option>
                                <mat-option value="3">3</mat-option>
                                <mat-option value="4">4</mat-option>
                                <mat-option value="5">5</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col>
                            <mat-form-field appearance="legacy">
                              <input type="text" maxlength="200" matInput formControlName="observaciones"
                                     autocomplete="off">
                              <mat-label>Observaciones</mat-label>
                            </mat-form-field>
                          </ion-col>
                        </ion-row>

                      </form>
                    </ion-col>
                  </ion-row>
                </ion-card-content>
                <div class="card-action-buttons">
                  <ion-button color="success" *ngIf="dragObjs.length > 0" (click)="saveProcess('check_form_list')">
                    SIGUIENTE
                  </ion-button>
                </div>
              </ion-card>
            </mat-expansion-panel>
          </div>
        </mat-accordion> <!--   Check List - Salida -->
        <mat-accordion *ngIf="!contractData || (contractData && contractData.estatus != 2 )">
          <div class="accordion-margin">
            <mat-expansion-panel [expanded]="step === 5" hideToggle hideToggle
                                 [disabled]="step == 0 || step == 1 || step == 2 || step == 3 || step == 4">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Firma
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="pencil"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <ion-card [disabled]="step >= 6">
                <ion-card-content>
                  <ion-row>
                    <ion-col size="12" style="display:inline">
                      <mat-checkbox size="6" [(ngModel)]="terminos"></mat-checkbox>
                      <div size="6">Firmó y aceptó este contrato en donde declaro tener conocimiento de todas la condiciones establecidas y acepto el clausulado del mismo.
                      </div>
                    </ion-col>
                  </ion-row>
                  <hr style="background: var(--ion-color-secondary)">
                  <ng-container>
                    <app-signature-capture [signature_matrix]="signature_matrix"
                                           (signatureEmit)="captureSignature($event)" [ngClass]="{'disable': !terminos}"
                                           [instanceType]="'plain'"></app-signature-capture>
                  </ng-container>

                </ion-card-content>
              </ion-card>
              <ion-card-title>
                <div class="card-action-buttons">
                  <ion-button color="success" *ngIf="step < 6" (click)="saveAndGenerate('firma')">Terminar</ion-button>
                </div>
              </ion-card-title>
            </mat-expansion-panel>
          </div>
        </mat-accordion> <!-- Captura Firma -->
      </ion-col>
    </ion-row>

    <ion-item-divider *ngIf="step >= 6">
      <ion-label>
        Retorno vehículo
      </ion-label>
    </ion-item-divider>

    <ion-row *ngIf="step >= 6">
      <ion-col>
        <mat-accordion>
          <div class="accordion-margin">
            <mat-expansion-panel [expanded]="step >= 6" hideToggle hideToggle
                                 [disabled]="step == 0 || step == 1 || step == 2 || step == 3 || step == 4 || step == 5 ">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Datos Retorno
                </mat-panel-title>
                <mat-panel-description style="margin: 0; justify-content: flex-end;">
                  <ion-icon name="car-sport-outline"></ion-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>

              <form [formGroup]="retornoDataForm">
                <ion-card>
                  <ion-card-content>
                    <ion-row>
                      <ion-col size="12" size-md="12">
                        <ion-row>
                          <ion-col size="12" size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>Capacidad Tanque</mat-label>
                              <input type="number" matInput [disabled]="true"
                                     autocomplete="off"
                                     [value]="vehiculoData && vehiculoData.cap_tanque ? vehiculoData.cap_tanque : null"
                                     style="text-align: right;">
                              <span matSuffix>LT</span>
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col>
                          <ion-col size="12" size-md="4">
                            <mat-form-field appearance="legacy" hintLabel="Solo Lectura">
                              <mat-label>Combustible Salida</mat-label>
                              <input matInput readonly [value]="vf.cant_combustible_salida.value">
                              <mat-hint align="end">{{convertFractionToLiters(vf.cant_combustible_salida.value)}}
                                Litros
                              </mat-hint>
                            </mat-form-field>
                          </ion-col>
                          <ion-col size="12" size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>Cant. Combustible retorno</mat-label>
                              <mat-select formControlName="cant_combustible_retorno"
                                          (selectionChange)="makeCalcRetorno()">
                                <mat-option value="1/8">1/8</mat-option>
                                <mat-option value="2/8">2/8</mat-option>
                                <mat-option value="3/8">3/8</mat-option>
                                <mat-option value="4/8">4/8</mat-option>
                                <mat-option value="5/8">5/8</mat-option>
                                <mat-option value="6/8">6/8</mat-option>
                                <mat-option value="7/8">7/8</mat-option>
                                <mat-option value="8/8">8/8</mat-option>
                              </mat-select>
                              <mat-error *ngIf="rf.cant_combustible_retorno.errors?.required">Campo requerido
                              </mat-error>
                              <mat-hint [ngStyle]="{'color': faltanLitros() ? 'red': 'green'}"
                                        align="start">{{convertFractionToLiters(rf.cant_combustible_retorno.value)}}
                                Litros retorno
                              </mat-hint>
                              <mat-hint [ngStyle]="{'color': faltanLitros() ? 'red': 'green'}"
                                        align="end">{{convertFractionToLiters(vf.cant_combustible_salida.value) - convertFractionToLiters(rf.cant_combustible_retorno.value) | number : '1.2-2'}}
                                Litros x cobrar
                              </mat-hint>
                              <mat-icon *ngIf="faltanLitros()" matSuffix color="warn">warning</mat-icon>
                            </mat-form-field> <!-- Cant. Combustible salida -->
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col size="6">
                            <mat-form-field appearance="legacy">
                              <mat-label>Km. Salida</mat-label>
                              <input matInput readonly [value]="vf.km_inicial.value">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col>
                          <ion-col size size-md="6">
                            <mat-form-field appearance="legacy">
                              <mat-label>Km. Final</mat-label>
                              <input matInput type="number" formControlName="km_final" autocomplete="off">
                              <mat-error *ngIf="rf.km_final.errors?.required">Campo requerido</mat-error>
                              <mat-error *ngIf="rf.km_final.errors?.min">El km final debe ser mayor al km inicial.
                              </mat-error>
                              <mat-hint *ngIf="rf.km_final.disabled">Solo lectura</mat-hint>
                            </mat-form-field> <!-- Km. Final-->
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col size="12" size-md="6">
                            <ion-row class="ion-no-margin ion-no-padding">
                              <ion-col size="12">
                                <div style="display: flex; align-items: center; justify-content: flex-end;">
                                  <ion-label style="padding-right: 12px">Cargos Extras?</ion-label>
                                  <ion-toggle (ionChange)="showRetornoExtras();" [(ngModel)]="cargos_extras_toggle"
                                              [ngModelOptions]="{standalone: true}"></ion-toggle>
                                </div>
                              </ion-col>
                            </ion-row>

                          </ion-col>
                          <ion-col size="12" size-md="6" *ngIf="cargos_extras_toggle">
                            <mat-form-field appearance="legacy">
                              <mat-label> Cargos Extras</mat-label>
                              <mat-select [multiple]="true" (selectionChange)="pushSelectedCargosExtras()"
                                          formControlName="cargos_extras_retorno_ids">
                                <mat-option *ngFor="let extrasRetorno of cargosExtras"
                                            [value]="extrasRetorno.id">{{extrasRetorno.nombre}}</mat-option>
                              </mat-select>
                            </mat-form-field>
                          </ion-col> <!-- Extras -->
                        </ion-row>
                        <hr>
                        <ion-row *ngIf="this.extraFrecuency > 0">
                          <ion-col size="12" size-md="6">
                            <ion-row>
                              <ion-col size="12" size-md="4">
                                <div
                                  style="display:flex; flex-direction: column; justify-content: space-between; text-align: center; font-size: 12px">
                                  <ng-container *ngIf="cobranzaExtraPor === 'horas'; else cobroXFecha">
                                    <div>
                                      Hora retorno: <br> {{hora_retorno}}
                                    </div>
                                    <div>
                                      Hora actual: <br> {{hora_actual}}
                                    </div>
                                  </ng-container>
                                  <ng-template #cobroXFecha>
                                    <div>
                                      Fecha retorno: <br> {{fecha_retorno}}
                                    </div>
                                    <hr>
                                    <div>
                                      Fecha actual: <br> {{fecha_actual}}
                                    </div>
                                  </ng-template>
                                </div>
                              </ion-col>
                              <ion-col size="12" size-md="8">
                                <div style="display: flex; align-items: center; justify-content: flex-end;">
                                  <ion-label style="padding-right: 12px">
                                    Aplicar {{cobranzaExtraPor === 'horas' ? 'horas' : 'dias'}} Extras?
                                  </ion-label>
                                  <ion-toggle [(ngModel)]="frecuencia_extras_toggle" (ionChange)="makeCalcRetorno()"
                                              [ngModelOptions]="{standalone: true}"></ion-toggle>
                                </div>
                              </ion-col>
                            </ion-row>
                          </ion-col>
                          <ion-col size="12" size-md="6" *ngIf="frecuencia_extras_toggle">
                            <mat-form-field appearance="legacy">
                              <mat-label> {{cobranzaExtraPor === 'horas' ? 'Horas' : 'Días'}} Extras</mat-label>
                              <input matInput type="number" autocomplete="off" formControlName="frecuencia_extra"
                                     (change)="makeCalcRetorno()">
                            </mat-form-field>
                          </ion-col>
                        </ion-row>
                      </ion-col>
                    </ion-row>
                    <mat-divider></mat-divider>

                    <ion-row>
                      <ion-col size="12" size-md="6">
                        <ion-row>
                          <ion-col size="12" class="ion-text-center ion-align-self-center">
                            <div
                              style="display: flex; flex-direction: column; align-items: flex-start; padding-left: 12px">
                              <mat-checkbox
                                class="example-margin"
                                [labelPosition]="'after'"
                                (change)="makeCalcRetorno()"
                                formControlName="con_iva_retorno"
                              >
                                Aplicar IVA ?
                              </mat-checkbox>
                            </div>

                          </ion-col> <!-- aplicar IVA | aplicar descuento -->
                        </ion-row>
                      </ion-col> <!-- precio unitario | aplicar IVA | aplicar descuento -->

                      <ion-col size="12" size-md="6">
                        <div style="text-align: center">
                          <p style="margin: 0; padding: 1rem;">Desgloce cargos extras</p>
                          <small *ngIf="cobranzaRetornoI && cobranzaRetornoI.length === 0">En espera para iniciar
                            calculo ....</small>
                        </div>
                        <table class="desgloce-cobro-table" *ngIf="cobranzaRetornoI && cobranzaRetornoI.length > 0">
                          <thead>
                          <tr>
                            <th></th>
                            <th>Monto</th>
                            <th>Cantidad</th>
                            <th>Costo MXN</th>
                          </tr>
                          </thead>
                          <tbody>
                          {{getExtraRows()}}
                          <ng-container *ngFor="let cobranza of cobranzaRetornoI; let i = index">
                            <tr [ngClass]="{'total-row': cobranza.element === 'total'}">
                              <td>{{cobranza.element_label}}</td>
                              <td>{{cobranza.value | currency}}</td>
                              <td>
                                <ng-container *ngIf="cobranza.element == 'cargoExtra';else Else">
                                  <div class="table-input">
                                    <div style="display: flex;align-items: center;">
                                      <input type="number" autocomplete="off" [(ngModel)]="cobranza.quantity"
                                             (ngModelChange)="makeCalcRetorno('extra', cobranza)"
                                             [ngModelOptions]="{standalone: true}">
                                    </div>
                                  </div>
                                </ng-container>
                                <ng-template #Else>
                                  {{cobranza.quantity}} {{cobranza.quantity_type}}
                                </ng-template>

                              </td>
                              <td>{{(cobranza.number_sign === 'negative' ? '-' : '')}} {{cobranza.amount | currency}}</td>
                            </tr>
                          </ng-container>

                          </tbody>
                        </table>
                      </ion-col> <!-- desbloce de cobro -->
                    </ion-row> <!-- precio unitario | aplicar IVA | aplicar descuento | desbloce de cobro -->
                    <div class="card-action-buttons" *ngIf="step >=6">
                      <ion-button color="success"
                                  (click)="saveProcess('retorno')">{{ (balanceRetornoPorPagar !== 0) ? "SIGUIENTE" : "TERMINAR" }}</ion-button>
                    </div>
                  </ion-card-content>
                </ion-card>
              </form>

              <ion-card *ngIf="step >=7">
                <ion-card-content>
                  <h4 style="font-weight: 500">DESCRIPCION DE LOS CARGOS EXTRAS</h4>
                  <br>
                  <mat-divider></mat-divider>
                  <br>
                  <ion-row>
                    <ion-col size="6">
                      <h4 style="margin: 0; padding: 0;">Total: <span
                        style="color: var(--ion-color-success)">${{(retornoDataForm && retornoDataForm.controls.total_retorno.value) ? (retornoDataForm.controls.total_retorno.value | currency) : '--'}}
                        MXN</span></h4>
                      <h4 style="margin: 0; padding: 0;">Balance por saldar: <span
                        [ngClass]="{'danger-color': balanceRetornoPorPagar > 0}">${{(balanceRetornoPorPagar) ? (balanceRetornoPorPagar | currency) : ('0' | currency)}}
                        MXN</span></h4>
                    </ion-col>
                    <ion-col size="6" class="ion-text-end">
                      <button mat-raised-button class="button-secondary" (click)="agregarPagoOpt('retorno')">
                        <span style="font-size: 1.3rem;margin-right: 0.5rem;">+</span>&nbsp;Cobro&nbsp;<ion-icon
                        name="wallet"></ion-icon>
                      </button>
                    </ion-col>
                  </ion-row>
                  <br>
                  <ion-row>
                    <ion-col size="12" size-md="6">
                      <ion-card style="margin: 0;">
                        <ion-card-content>
                          <div class="accordion-title">
                          <span class="icon">
                             <ion-icon name="checkmark-circle"
                                       [color]="(balanceRetornoPorPagar >= 0) ? 'success': ''"></ion-icon>
                          </span>
                            <span>
                            Pagado
                          </span>
                            <span>
                            ${{pagadoRetornoTotal | currency}} MXN
                          </span>
                          </div>

                          <mat-accordion>
                            <ng-container *ngFor="let cobranzaPago of cobranzaProgRetornoData">
                              <mat-expansion-panel style="margin-top: 1rem"
                                                   *ngIf="cobranzaPago.tipo === cobranzaTipos.PAGOTARJETA">
                                <mat-expansion-panel-header>
                                  <mat-panel-title>
                                    Tarjeta
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    <div class="tarjeta-resume">
                                  <span class="tipo-tarjeta">
                                    {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}
                                  </span>
                                      <span>
                                    {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_cn4) ? cobranzaPago.tarjeta.c_cn4 : '--'}}
                                  </span>
                                      <span>
                                       ${{(cobranzaPago.monto_cobrado) ? (cobranzaPago.monto_cobrado | currency) : ('0' | currency) }} {{cobranzaPago.moneda_cobrada}}
                                  </span>
                                    </div>
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <ion-row class="border-ion-row">
                                  <ion-col size="12" *ngIf="cobranzaPago.tipo_cambio && cobranzaPago.tipo_cambio_id">
                                    <div style="display: flex; justify-content: space-between;">
                                      <span>Tipo Cambio</span>
                                      <span>1 {{cobranzaPago.moneda_cobrada}}
                                        = {{cobranzaPago.tipo_cambio}} {{cobranzaPago.moneda}}</span>
                                    </div>
                                  </ion-col>
                                  <ion-col size="12">
                                    <ion-row>
                                      <ion-col size="fill">
                                        <div class="action-buttons">
                                          <button *ngIf="cobranzaPago.id && cobranzaPago.edit !== true"
                                                  (click)="cancelCobro(cobranzaPago, 'retorno')"
                                                  class="mat-elevation-z0" mat-mini-fab color="warn">
                                            <mat-icon>remove</mat-icon>
                                          </button>
                                          <button *ngIf="cobranzaPago.edit !== true && cobranzaPago.id"
                                                  (click)="editCobro(cobranzaTipos.PAGOTARJETA, 'retorno', cobranzaPago)"
                                                  style="margin-top: 10px" class="mat-elevation-z0" mat-mini-fab
                                                  color="accent">
                                            <mat-icon>edit</mat-icon>
                                          </button>
                                        </div>
                                      </ion-col>
                                      <ion-col size>
                                        <div class="info-card">
                                          <div class="info-row">
                                            <span>Tipo Tarjeta: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Num. Tarjeta: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_cn1 && cobranzaPago.tarjeta.c_cn4)) ? cobranzaPago.tarjeta.c_cn1 + '*' + cobranzaPago.tarjeta.c_cn4 : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Mes / Año: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_month && cobranzaPago.tarjeta.c_year)) ? cobranzaPago.tarjeta.c_month + '/' + cobranzaPago.tarjeta.c_year : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Aprobación Banco: </span>
                                            <p>
                                              {{cobranzaPago.cod_banco}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Monto: </span>
                                            <p>
                                              ${{cobranzaPago.monto_cobrado | currency}} {{cobranzaPago.moneda_cobrada}}
                                            </p>
                                          </div>
                                        </div>
                                      </ion-col>
                                    </ion-row>
                                  </ion-col>
                                  <ion-col size="12" class="ion-no-padding">
                                    <app-modelos-docs model="cobranza" docType="voucher" btnSize="small"
                                                      [justButton]="true" [fullSize]="true"
                                                      [model_id_value]="cobranzaPago.id">
                                      <legend name="legend">Img. Voucher</legend>
                                    </app-modelos-docs>
                                  </ion-col>
                                </ion-row>
                              </mat-expansion-panel> <!-- cobranzaTipos.PAGOTARJETA -->
                              <mat-expansion-panel style="margin-top: 1rem"
                                                   *ngIf="cobranzaPago.tipo === cobranzaTipos.PAGOEFECTIVO">
                                <mat-expansion-panel-header #panelH>
                                  <mat-panel-title>
                                    Efectivo
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    <div class="tarjeta-resume">
                                <span style="padding-right: 0.5em">
                                  {{cobranzaPago.monto_cobrado | currency}} {{cobranzaPago.moneda_cobrada}}
                                </span>
                                    </div>
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <ion-row>
                                  <ion-col size="12" *ngIf="cobranzaPago.tipo_cambio && cobranzaPago.tipo_cambio_id">
                                    <div style="display: flex; justify-content: space-between;">
                                      <span>Tipo Cambio</span>
                                      <span>1 {{cobranzaPago.moneda_cobrada}}
                                        = {{cobranzaPago.tipo_cambio}} {{cobranzaPago.moneda}}</span>
                                    </div>
                                  </ion-col>
                                  <ion-col size="12">
                                    <div style="display: flex; justify-content: space-evenly;">
                                      <button *ngIf="cobranzaPago.id && cobranzaPago.edit !== true"
                                              (click)="cancelCobro(cobranzaPago, 'retorno')" class="mat-elevation-z0"
                                              mat-mini-fab color="warn">
                                        <mat-icon>remove</mat-icon>
                                      </button>
                                      <button *ngIf="cobranzaPago.edit !== true && cobranzaPago.id"
                                              (click)="editCobro(cobranzaTipos.PAGOEFECTIVO, 'retorno', cobranzaPago)"
                                              class="mat-elevation-z0" mat-mini-fab color="accent">
                                        <mat-icon>edit</mat-icon>
                                      </button>
                                    </div>

                                  </ion-col>
                                </ion-row>
                              </mat-expansion-panel> <!-- cobranzaTipos.PAGOEFECTIVO -->
                              <mat-expansion-panel style="margin-top: 1rem"
                                                   *ngIf="cobranzaPago.tipo === cobranzaTipos.PAGODEPOSITO">
                                <mat-expansion-panel-header>
                                  <mat-panel-title>
                                    Tarjeta
                                  </mat-panel-title>
                                  <mat-panel-description>
                                    <div class="tarjeta-resume">
                                  <span class="tipo-tarjeta">
                                    {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}
                                  </span>
                                      <span>
                                    {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_cn4) ? cobranzaPago.tarjeta.c_cn4 : '--'}}
                                  </span>
                                      <span>
                                       {{(cobranzaPago.monto_cobrado) ? (cobranzaPago.monto_cobrado | currency) : ('0' | currency) }} {{cobranzaPago.moneda_cobrada}}
                                  </span>
                                    </div>
                                  </mat-panel-description>
                                </mat-expansion-panel-header>
                                <ion-row class="border-ion-row">
                                  <ion-col size="12" *ngIf="cobranzaPago.tipo_cambio && cobranzaPago.tipo_cambio_id">
                                    <div style="display: flex; justify-content: space-between;">
                                      <span>Tipo Cambio</span>
                                      <span>1 {{cobranzaPago.moneda_cobrada}}
                                        = {{cobranzaPago.tipo_cambio}} {{cobranzaPago.moneda}}</span>
                                    </div>
                                  </ion-col>
                                  <ion-col size="12">
                                    <ion-row>
                                      <ion-col size="fill">
                                        <div class="action-buttons">
                                          <button *ngIf="cobranzaPago.id && cobranzaPago.edit !== true"
                                                  (click)="cancelCobro(cobranzaPago, 'retorno')"
                                                  class="mat-elevation-z0" mat-mini-fab color="warn">
                                            <mat-icon>remove</mat-icon>
                                          </button>
                                          <button *ngIf="cobranzaPago.edit !== true && cobranzaPago.id"
                                                  (click)="editCobro(cobranzaTipos.PAGODEPOSITO, 'retorno', cobranzaPago)"
                                                  style="margin-top: 10px" class="mat-elevation-z0" mat-mini-fab
                                                  color="accent">
                                            <mat-icon>edit</mat-icon>
                                          </button>
                                        </div>
                                      </ion-col>
                                      <ion-col size>
                                        <div class="info-card">
                                          <div class="info-row">
                                            <span>Tipo Tarjeta: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Num. Tarjeta: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_cn1 && cobranzaPago.tarjeta.c_cn4)) ? cobranzaPago.tarjeta.c_cn1 + '*' + cobranzaPago.tarjeta.c_cn4 : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Mes / Año: </span>
                                            <p>
                                              {{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_month && cobranzaPago.tarjeta.c_year)) ? cobranzaPago.tarjeta.c_month + '/' + cobranzaPago.tarjeta.c_year : '--'}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Aprobación Banco: </span>
                                            <p>
                                              {{cobranzaPago.cod_banco}}
                                            </p>
                                          </div>
                                          <div class="info-row">
                                            <span>Monto: </span>
                                            <p>
                                              {{cobranzaPago.monto_cobrado | currency}} {{cobranzaPago.moneda_cobrada}}
                                            </p>
                                          </div>
                                        </div>
                                      </ion-col>
                                    </ion-row>
                                  </ion-col>
                                  <ion-col size="12" class="ion-no-padding">
                                    <app-modelos-docs model="cobranza" docType="voucher" btnSize="small"
                                                      [justButton]="true" [fullSize]="true"
                                                      [model_id_value]="cobranzaPago.id">
                                      <legend name="legend">Img. Voucher</legend>
                                    </app-modelos-docs>
                                  </ion-col>
                                </ion-row>
                              </mat-expansion-panel> <!-- cobranzaTipos.PAGOTARJETA -->
                            </ng-container>

                          </mat-accordion>
                        </ion-card-content>
                      </ion-card>

                    </ion-col>
                  </ion-row> <!-- Pagado  -->

                </ion-card-content>
                <ion-card-title>
                  <div class="card-action-buttons" *ngIf="balanceRetornoPorPagar == 0">
                    <ion-button color="success" (click)="finalizarRetorno()">Terminar</ion-button>
                  </div>
                </ion-card-title>
              </ion-card>


            </mat-expansion-panel>
          </div>
        </mat-accordion> <!-- Retorno vehiculo -->
      </ion-col>
    </ion-row>

  </div>

</ion-content>
