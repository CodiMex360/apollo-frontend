<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content id="revisionRowH">
  <ion-row style="margin: 1.2rem;">


    <ion-col size="6">
      <h2 style="color: var(--ion-color-dark-tint)">ESTATUS: {{(contractData) ? statusC.labelStatus(contractData.estatus) : 'NUEVO CONTRATO'}}</h2>

      <ion-row>
        <ion-col size="12" class="ion-align-self-center ion-no-padding ion-no-margin">
          <div class="folio-copy" *ngIf="num_contrato">
            <ion-label style="font-size: 1.2rem; margin-right: 1rem;">
              Num. Contrato: {{num_contrato}}
            </ion-label>
<!--            <ion-button fill="outline" (click)="generalServ.copyClickBoard(num_contrato)">-->
<!--              <ion-icon slot="icon-only" name="copy"></ion-icon>-->
<!--            </ion-button>-->
          </div>
          <div *ngIf="!num_contrato" class="status-badge-container">
            <span>Estatus</span>
            <ion-badge slot="end" color="warning">Sin guardar</ion-badge>
          </div>
        </ion-col>
      </ion-row>
    </ion-col>

    <ion-col size="6" class="ion-text-end">
      <button mat-raised-button class="button-success">Crear Contrato</button>
      &nbsp;
      <button mat-raised-button class="button-cancel">Cancelar Contrato</button>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col size="12">
      <mat-accordion>
        <div class="accordion-margin" [formGroup]="generalDataForm" *ngIf="generalDataForm">
          <mat-expansion-panel (opened)="setStep(0)" [expanded]="step === 0" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Datos Generales
              </mat-panel-title>
              <mat-panel-description style="margin: 0; justify-content: flex-end;">
                <ion-icon name="calendar"></ion-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>
            <form [formGroup]="generalDataForm">
              <ion-card>
                <ion-card-content>
                  <ion-row>
                    <ion-col size="12" size-md="7">
                      <div *ngIf="vehiculoData">
                        <ion-row>
                          <ion-col size="12">
                            <div class="search-row-buttons">
                              <ion-button size="small" color="secondary" (click)="openModalSearch('vehiculos', 'vehiculo')">
                                <ion-icon name="search"></ion-icon>
                              </ion-button>
                            </div>
                          </ion-col>
                        </ion-row> <!-- openModalSearch -->
                        <ion-row class="ion-no-padding ion-no-margin">
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Código Vehículo</mat-label>
                              <input type="text" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.codigo ? vehiculoData.codigo : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Código Vehículo-->
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Marca</mat-label>
                              <input type="text" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.marca && vehiculoData.marca.marca ? vehiculoData.marca.marca : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Marca-->
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Modelo</mat-label>
                              <input type="text" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.modelo ? vehiculoData.modelo : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Modelo-->
                          <ion-col size>
                            <mat-form-field appearance="legacy">
                              <mat-label>Color</mat-label>
                              <input type="text" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.color ? vehiculoData.color : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Color-->
                        </ion-row> <!-- Código Vehículo  Marca  Modelo  Color -->
                        <ion-row class="ion-no-padding ion-no-margin">
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>No. Placas</mat-label>
                              <input type="text" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.placas ? vehiculoData.placas : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--No. Placas-->
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>No. Serie</mat-label>
                              <input type="text" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.num_serie ? vehiculoData.num_serie : null">
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--No. Serie-->
                          <ion-col size size-md="4">
                            <mat-form-field appearance="legacy">
                              <mat-label>Capacidad Tanque</mat-label>
                              <input type="number" matInput [disabled]="true" [value]="vehiculoData && vehiculoData.cap_tanque ? vehiculoData.cap_tanque : null" style="text-align: right;">
                              <span matSuffix>LT</span>
                              <mat-hint>Solo lectura</mat-hint>
                            </mat-form-field>
                          </ion-col> <!--Capacidad Tanque-->
                        </ion-row> <!-- No. Placas  No.Serie  Capacidad Tanque  -->
                      </div>
                      <div *ngIf="!vehiculoData">
                        <ion-row>
                          <ion-col size="12">
                            <div class="ion-text-center">
                              Seleccione un vehículo
                              &nbsp;
                              <ion-button size="small" color="secondary" (click)="openModalSearch('vehiculos', 'vehiculo')">
                                <ion-icon name="search"></ion-icon>
                              </ion-button>
                            </div>
                          </ion-col>
                        </ion-row> <!-- openModalSearch -->
                      </div>
                    </ion-col> <!-- datos vehiculo -->
                    <ion-col size="12" size-md="3">
                      <div class="datos-generales-precioU">
                        <h2>Valor unitario x día</h2>
                        <p>{{(gf.precio_unitario_final && gf.precio_unitario_final.value ? (gf.precio_unitario_final.value | currency) : '--')}}</p>
                      </div>
                    </ion-col> <!-- precio unitario -->
                    <ion-col size="12" size-md="2">
                      <mat-form-field appearance="outline">
                        <mat-label>Tipo Tarifa</mat-label>
                        <mat-select #tipoTarifa (selectionChange)="initTipoTarifaRule();" formControlName="tipo_tarifa">
                          <mat-option *ngFor="let tarifa of tiposTarifas" [value]="tarifa.tarifa">{{tarifa.tarifa}}</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </ion-col> <!-- tipo de tarifa picker -->
                  </ion-row>
                  <mat-divider></mat-divider>
                  <ion-row>
                    <ion-col size="12" size-md="6"> <!-- Fecha salida - retorno, aplicar iva, extras -->

                      <ion-row *ngIf="gf.tipo_tarifa.value == 'Hotel'">
                        <ion-col size="12" size-md="6">
                          <mat-form-field appearance="legacy">
                            <mat-label>Hotel</mat-label>
                            <mat-select formControlName="tarifa_modelo_id" (selectionChange)="loadHotelTarifas(true)">
                              <mat-option *ngFor="let hotel of hoteles" [value]="hotel.id">{{hotel.nombre}}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="gf.tarifa_modelo_id.errors?.required">Campo requerido</mat-error>
                          </mat-form-field>
                        </ion-col>

                        <ion-col size="12" size-md="6">
                          <mat-form-field appearance="legacy">
                            <mat-label>Vehículo Clase</mat-label>
                            <mat-select formControlName="vehiculo_clase_id" (selectionChange)="setVehiculoClaseData(true)">
                              <mat-option *ngFor="let clase of tarifasHotel" [value]="clase.clase_id">{{clase.clase}}</mat-option>
                            </mat-select>
                            <mat-error></mat-error>
                          </mat-form-field>
                        </ion-col>



                        <ion-col size="12" class="ion-text-center">
                          <fieldset style="padding-bottom: 2rem;">
                            <ng-container>
                              <ion-row>
                                <ion-col size="12" size-md="6">
                                  <mat-form-field appearance="legacy">
                                    <mat-label>Folio Cupón</mat-label>
                                    <input matInput type="text" autocomplete="off" formControlName="folio_cupon">
                                    <mat-error></mat-error>
                                  </mat-form-field>
                                </ion-col>

                                <ion-col size="12" size-md="6" class="ion-text-center">
                                  <div style="display: flex; justify-content: space-evenly; align-items: center;">
                                    <app-camera (captureImg)="processDataImage($event, 'contratos')" [justButton]="true" [btnSize]="'small'"></app-camera>
                                    <ion-button [disabled]="disableUploadButton('contratos')" *ngIf="contratos_docs && contratos_docs.length > 0" color="secondary" size="small" expand="round" type="button" (click)="uploadArrayDatasImg('cupon', 'contratos', contract_id)" style="width: 250px;">
                                      <ion-icon name="cloud-upload"></ion-icon>&nbsp; SUBIR
                                    </ion-button>
                                  </div>
                                </ion-col>
                              </ion-row>

                              <div style="display: flex; justify-content: center; flex-direction: column;" *ngIf="contratos_docs.length > 0">

                                <ion-row >
                                  <ion-col size="6" size-sm="auto" *ngFor="let imgData of contratos_docs; let i = index" style="margin-bottom: 1rem;">
                                    <div class="capture-img-container">
                                      <div class="btn-action-container">
                                        <ion-button size="small" color="danger" (click)="removeImg(i, 'contratos')" *ngIf="!imgData.file_id">
                                          <ion-icon name="trash"></ion-icon>
                                        </ion-button>

                                        <ion-button size="small" color="danger" (click)="removeFromDisk(imgData, i, 'contratos')" *ngIf="imgData.file_id">
                                          <ion-icon name="trash"></ion-icon>
                                        </ion-button>
                                      </div>
                                      <div class="upload-indications" *ngIf="imgData.success || !imgData.file_id">
                                        <ion-icon name="cloud-upload" class="base-indicator"></ion-icon>
                                        <ion-icon name="checkmark-sharp" class="indicator success" *ngIf="imgData.success === true"></ion-icon>
                                        <ion-icon name="close-sharp" class="indicator success" *ngIf="imgData.success === false"></ion-icon>
                                        <ion-icon name="hourglass-outline" class="indicator temp" *ngIf="!imgData.file_id"></ion-icon>
                                      </div>
                                      <ion-img [src]="imgData.url" *ngIf="isImage(imgData.mime_type) === true"></ion-img>
                                      <ion-img src="assets/img/pdf-icon.png" *ngIf="imgData.mime_type === 'application/pdf'" style="width: 60%;margin: auto 0;"></ion-img>
                                      <div class="loader-upload" *ngIf="imgData.uploading === true">
                                        <ion-spinner name="bubbles" *ngIf="imgData.uploading === true"></ion-spinner>
                                        <!--<ion-icon name="checkmark-sharp" *ngIf="imgData.success === true" style="color: #44bd00;font-size: 3rem;background: #f9f9f9;border-radius: 50%;padding: 8px;"></ion-icon>-->
                                      </div>
                                      <!--                            <ion-icon class="wrong-upload" name="close-sharp" *ngIf="imgData.success === false"></ion-icon>-->
                                      <div class="file-name">
                                        <label for="">Etiqueta</label>
                                        <input type="text" autocomplete="off" value="{{imgData.etiqueta}}" [(ngModel)]="imgData.etiqueta" [disabled]="(imgData.file_id && imgData.file_id > 0 ? true : false)" [ngModelOptions]="{standalone: true}">
                                        <small class="error" *ngIf="imgData.fileErrors">{{imgData.fileErrors}}</small>
                                      </div>
                                    </div>
                                  </ion-col>
                                </ion-row>

                                <!-- <ion-img [src]="bodyImgURL"></ion-img> -->
                              </div>

                            </ng-container>
                          </fieldset>
                        </ion-col>
                      </ion-row> <!-- Tipo de tarifa = Hotel -->

                      <ion-row *ngIf="gf.tipo_tarifa.value == 'Comisionista'">
                        <ion-col size="12" size-md="6">
                          <mat-form-field appearance="legacy">
                            <mat-label>Comisionista</mat-label>
                            <mat-select formControlName="tarifa_modelo_id" (selectionChange)="setComisiones(true)">
                              <mat-option *ngFor="let comisionista of comisionistas" [value]="comisionista.id">{{comisionista.nombre}} {{comisionista.apellidos}}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="gf.tarifa_modelo_id.errors?.required">Campo requerido</mat-error>
                          </mat-form-field>
                        </ion-col>
                        <ion-col size="12" size-md="6">
                          <mat-form-field appearance="legacy">
                            <mat-label>Cantidad Comisión</mat-label>
                            <mat-select formControlName="comision" (selectionChange)="initCalcComisionista();">
                              <mat-option *ngFor="let comision of comisiones" [value]="comision">{{comision}}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="gf.comision.errors?.required">Campo requerido</mat-error>
                          </mat-form-field>
                        </ion-col>
                      </ion-row>  <!-- Tipo de tarifa = Comisionista -->

                      <ion-row>

                        <ion-col size="12">
                          <mat-slide-toggle [(ngModel)]="useCalendar" [ngModelOptions]="{standalone: true}">
                            Usar calendario
                          </mat-slide-toggle>
                        </ion-col>

                        <ion-col size="12" size-md="6" *ngIf="useCalendar === false">
                          <mat-form-field appearance="legacy">
                            <mat-label>Días de renta</mat-label>
                            <input type="number" #totalDays matInput formControlName="total_dias" (input)="setReturnDateChange(totalDays.value)">
                            <span matSuffix>{{(gf.total_dias.value > 1 ? 'días' : 'día')}}</span>
                            <mat-hint style="font-size: 1.1em" *ngIf="rangoFechas.fecha_retorno.value && rangoFechas.fecha_salida.value">
                              <mat-icon style="font-size: 1.1em; vertical-align: middle;">event</mat-icon>
                              {{dateConv.transFormDate(rangoFechas.fecha_salida.value, 'slash')}} -
                              {{dateConv.transFormDate(rangoFechas.fecha_retorno.value, 'slash')}}
                            </mat-hint>
                          </mat-form-field>
                        </ion-col>

                        <ion-col size="12" size-md="6" *ngIf="useCalendar === true">
                          <mat-form-field appearance="legacy">
                            <mat-label>Fecha salida - retorno</mat-label>
                            <mat-date-range-input  [rangePicker]="fechaRetornoRegreso" [formGroup]="rangoFechasGroup" [min]="_today">
                              <input matStartDate formControlName="fecha_salida" placeholder="Start date" readonly autocomplete="off" (dateChange)="startDateChange()">
                              <input matEndDate formControlName="fecha_retorno" placeholder="End date" (dateChange)="setReturnDateChange()" readonly autocomplete="off">
                            </mat-date-range-input>
                            <mat-datepicker-toggle matSuffix [for]="fechaRetornoRegreso"></mat-datepicker-toggle>
                            <mat-date-range-picker #fechaRetornoRegreso></mat-date-range-picker>
                            <mat-hint>{{gf.total_dias.value}} {{(gf.total_dias.value > 1) ? 'días' : 'dia'}}</mat-hint>
                            <mat-error *ngIf="rangoFechas.fecha_salida.errors?.required">La fecha de salida es obligatoria</mat-error>
                            <mat-error *ngIf="rangoFechas.fecha_retorno.errors?.required">La fecha de retorno es obligatoria</mat-error>
                          </mat-form-field>
                        </ion-col> <!-- Fecha salida - retorno -->

                        <ion-col size="12" size-md="6" class="ion-text-center ion-align-self-center">
                          <div style="display: flex; flex-direction: column; align-items: flex-start; padding-left: 12px">
                            <mat-checkbox
                                    class="example-margin"
                                    [labelPosition]="'after'"
                                    (change)="makeCalc()"
                                    formControlName="con_iva"
                            >
                              Aplicar IVA ?
                            </mat-checkbox>
                            <mat-checkbox
                                    class="example-margin"
                                    [labelPosition]="'after'"
                                    (change)="makeCalc()"
                                    formControlName="con_descuento"
                            >
                              Aplicar Descuento ?
                            </mat-checkbox>
                          </div>

                        </ion-col> <!-- aplicar IVA -->

                        <ion-col size="12" size-md="6">
                          <mat-form-field appearance="legacy">
                            <mat-label>Extras</mat-label>
                            <mat-select  [multiple]="true" (selectionChange)="pushSelectedExtras()" formControlName="cobros_extras_ids">
                              <mat-option *ngFor="let extras of tarifasExtras" [value]="extras.id">{{extras.nombre}}</mat-option>
                            </mat-select>
                          </mat-form-field>
                        </ion-col> <!-- Extras -->

                      </ion-row>
                      <mat-divider></mat-divider>
                      <ion-row>
                        <ion-col size="12">
                          <h4 style="padding: 0; margin: 0 0 1rem;">Ubicaciones</h4>
                        </ion-col>

                        <ion-col size="12" size-md="6">
                          <!--<ion-row>
                            <ion-col size="6" class="ion-no-padding">
                              <h4 style="margin: 0; padding: 0;">Ubicaciones</h4>
                            </ion-col>
                            <ion-col size="6">
                              <div class="search-row-buttons">
                                <ion-button size="small" color="secondary" (click)="openModalSearch('ubicaciones', 'ubicacionSalida')">
                                  <ion-icon name="search"></ion-icon>
                                </ion-button>
                              </div>
                            </ion-col>
                          </ion-row>-->
                          <mat-form-field appearance="legacy">
                            <mat-label>Salida</mat-label>
                            <input type="text"
                                   placeholder="Pick one"
                                   matInput
                                   formControlName="ub_salida_id"
                                   [matAutocomplete]="ubSalidaAuto">
                            <mat-autocomplete  #ubSalidaAuto="matAutocomplete"  [displayWith]="displayUb.bind(this)">
                              <mat-option *ngFor="let ubicacion of exitPlacesOptions$ | async" [value]="ubicacion.id">
                                {{(ubicacion.alias) ? ubicacion.alias : ubicacion.direccion}}
                              </mat-option>
                            </mat-autocomplete>
<!--                            <mat-select formControlName="ub_salida_id">-->
<!--                              <mat-option *ngFor="let ubicacion of ubicaciones" [value]="ubicacion.id">{{(ubicacion.alias) ? ubicacion.alias : ubicacion.direccion}}</mat-option>-->
<!--                            </mat-select>-->
                            <mat-error *ngIf="gf.ub_salida_id.errors?.required">Campo requerido</mat-error>
                          </mat-form-field>
                        </ion-col>
                        <ion-col size="12" size-md="6">
<!--                          <ion-row>-->
<!--                            <ion-col size="12">-->
<!--                              <div class="search-row-buttons">-->
<!--                                <ion-button size="small" color="secondary" (click)="openModalSearch('ubicaciones', 'ubicacionRetorno')">-->
<!--                                  <ion-icon name="search"></ion-icon>-->
<!--                                </ion-button>-->
<!--                              </div>-->
<!--                            </ion-col>-->
<!--                          </ion-row>-->
                          <mat-form-field appearance="legacy">
                            <mat-label>Retorno</mat-label>
                            <mat-label>Salida</mat-label>
                            <input type="text"
                                   placeholder="Pick one"
                                   matInput
                                   formControlName="ub_retorno_id"
                                   [matAutocomplete]="ubRetornoAuto">
                            <mat-autocomplete  #ubRetornoAuto="matAutocomplete"  [displayWith]="displayUb.bind(this)">
                              <mat-option *ngFor="let ubicacion of returnPlacesOptions$ | async" [value]="ubicacion.id">
                                {{(ubicacion.alias) ? ubicacion.alias : ubicacion.direccion}}
                              </mat-option>
                            </mat-autocomplete>
<!--                            -->
<!--                            <mat-select formControlName="ub_retorno_id">-->
<!--                              <mat-option *ngFor="let ubicacion of ubicaciones" [value]="ubicacion.id">{{(ubicacion.alias) ? ubicacion.alias : ubicacion.direccion}}</mat-option>-->
<!--                            </mat-select>-->
                            <mat-error *ngIf="gf.ub_retorno_id.errors?.required">Campo requerido</mat-error>
                          </mat-form-field>
                        </ion-col>
                      </ion-row>
                    </ion-col>

                    <ion-col size="12" size-md="6">
                      <div style="text-align: center">
                        <p style="margin: 0; padding: 1rem;">Desgloce Cobro</p>
                        <small *ngIf="cobranzaI && cobranzaI.length === 0">En espera para iniciar calculo ....</small>
                      </div>
                      <table class="desgloce-cobro-table" *ngIf="cobranzaI && cobranzaI.length > 0">
                        <thead>
                        <tr>
                          <th></th>
                          <th>Monto</th>
                          <th>Cantidad</th>
                          <th>Costo MXN</th>
                        </tr>
                        </thead>
                        <tbody>
                        {{getExtraRows()}}
                        <ng-container *ngFor="let cobranza of cobranzaI; let i = index">
                          <tr *ngIf=" cobranza.element !== 'extra'" [ngClass]="{'total-row': cobranza.element === 'total'}">
                            <td>{{cobranza.element_label}}</td>
                            <td>{{cobranza.value | currency}}</td>
                            <td>{{cobranza.quantity}} {{cobranza.quantity_type}}</td>
                            <td>{{(cobranza.number_sign === 'negative' ? '-' : '')}} {{cobranza.amount | currency}}</td>
                          </tr>
                          <ng-container *ngIf="cobranza.element == 'extra'">
                            <tr class="extra-row">
                              <td>Extras</td>
                              <td colspan="3"></td>
                            </tr>
                            <tr>
                              <td>{{cobranza.element_label}}</td>
                              <td>{{cobranza.value | currency}}</td>
                              <td>
                                <div class="table-input">
                                  <div style="display: flex;align-items: center;">
                                    <input type="number" autocomplete="off" [(ngModel)]="cobranza.quantity" (ngModelChange)="makeCalc('extra', cobranza)" [ngModelOptions]="{standalone: true}">
                                    <span>x {{gf.total_dias.value}} días</span>
                                  </div>

                                </div>
                              </td>
                              <td>{{(cobranza.number_sign === 'negative' ? '-' : '')}} {{cobranza.amount | currency}}</td>
                            </tr>
                          </ng-container>
                        </ng-container>

                        </tbody>
                      </table>
                    </ion-col> <!-- desbloce de cobro -->

                  </ion-row>
                </ion-card-content>
                <div class="card-action-buttons">
                  <ion-button  color="success" (click)="saveProcess('datos_generales')">GUARDAR</ion-button>
                </div>
              </ion-card>

            </form>


            <mat-action-row>
              <button (click)="prevStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-back-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button> &nbsp; &nbsp;

              <button (click)="nextStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-forward-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </div>
      </mat-accordion> <!-- Datos Generales -->
      <mat-accordion>
        <div class="accordion-margin">
          <mat-expansion-panel (opened)="setStep(1)" [expanded]="step === 1" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Datos del Cliente
              </mat-panel-title>
              <mat-panel-description style="margin: 0; justify-content: flex-end;">
                <ion-icon name="person"></ion-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <ion-card>
              <ion-card-content>
                <form [formGroup]="clienteDataForm" *ngIf="clienteDataForm">
                  <ion-row>
                    <ion-col size="12">
                      <div class="search-row-buttons">
                        <ion-button size="small" color="secondary" (click)="openModalSearch('clientes', 'cliente')">
                          <ion-icon name="search"></ion-icon>
                        </ion-button>
                      </div>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>NOMBRE(S)</mat-label>
                        <input type="text" matInput formControlName="nombre" autocomplete="off">
                        <mat-error *ngIf="cf.nombre.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>APELLIDO(S)</mat-label>
                        <input type="text" matInput formControlName="apellidos" autocomplete="off">
                        <mat-error *ngIf="cf.apellidos.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                  </ion-row>

                  <ion-row>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>TELÉFONO</mat-label>
                        <input type="tel" matInput formControlName="telefono" autocomplete="off">
                        <mat-error *ngIf="cf.telefono.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>E-Mail</mat-label>
                        <input type="email" matInput formControlName="email" autocomplete="off">
                        <mat-error *ngIf="cf.email.errors?.required">Campo requerido</mat-error>
                        <mat-error *ngIf="cf.email.errors?.email">Email invalido</mat-error>
                      </mat-form-field>
                    </ion-col>
                  </ion-row>

                  <ion-row>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>DIRECCIÓN</mat-label>
                        <textarea matInput formControlName="direccion" autocomplete="off"></textarea>
                        <mat-error *ngIf="cf.direccion.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                  </ion-row>

                  <ion-row>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>Número de Licencia</mat-label>
                        <input type="text" matInput formControlName="num_licencia" autocomplete="off">
                        <mat-error *ngIf="cf.num_licencia.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>Mes Exp.</mat-label>
                        <mat-select formControlName="licencia_mes" autocomplete="off">
                          <mat-option *ngFor="let month of months" value="{{month.digit}}">{{month.month}}</mat-option>
                        </mat-select>
                        <mat-icon matSuffix>date_range</mat-icon>
                        <mat-error *ngIf="cf.licencia_mes.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                    <ion-col>
                      <mat-form-field appearance="legacy">
                        <mat-label>Año expiración</mat-label>
                        <mat-select formControlName="licencia_ano" autocomplete="off">
                          <mat-option *ngFor="let year of validYears" value="{{year}}">{{year}}</mat-option>
                        </mat-select>
                        <mat-icon matSuffix>date_range</mat-icon>
                        <mat-error *ngIf="cf.licencia_ano.errors?.required">Campo requerido</mat-error>
                      </mat-form-field>
                    </ion-col>
                  </ion-row>

                </form>


                <fieldset style="padding-bottom: 2rem;">
                  <legend>Doc. Cliente</legend>
                  <ng-container>
                    <ion-row>
                      <ion-col size="12" class="ion-text-center">
                        <div style="display: flex; justify-content: space-evenly; align-items: center;">
                          <app-camera (captureImg)="processDataImage($event, 'clientes')" [justButton]="true"></app-camera>
                          <ion-button [disabled]="disableUploadButton('clientes')" *ngIf="clientes_docs && clientes_docs.length > 0" color="secondary" expand="round" type="button" (click)="uploadArrayDatasImg('licencia_conducir', 'clientes', clienteDataForm.controls.cliente_id.value)" style="width: 250px;">
                            <ion-icon name="cloud-upload"></ion-icon>&nbsp; SUBIR
                          </ion-button>
                        </div>
                      </ion-col>
                    </ion-row>

                    <div style="display: flex; justify-content: center; flex-direction: column;" *ngIf="clientes_docs.length > 0">

                      <ion-row >
                        <ion-col size="6" size-sm="auto" *ngFor="let imgData of clientes_docs; let i = index" style="margin-bottom: 1rem;">
                          <div class="capture-img-container">
                            <div class="btn-action-container">
                              <ion-button size="small" color="danger" (click)="removeImg(i, 'clientes')" *ngIf="!imgData.file_id">
                                <ion-icon name="trash"></ion-icon>
                              </ion-button>

                              <ion-button size="small" color="danger" (click)="removeFromDisk(imgData, i, 'clientes')" *ngIf="imgData.file_id">
                                <ion-icon name="trash"></ion-icon>
                              </ion-button>
                            </div>
                            <div class="upload-indications" *ngIf="imgData.success || !imgData.file_id">
                              <ion-icon name="cloud-upload" class="base-indicator"></ion-icon>
                              <ion-icon name="checkmark-sharp" class="indicator success" *ngIf="imgData.success === true"></ion-icon>
                              <ion-icon name="close-sharp" class="indicator success" *ngIf="imgData.success === false"></ion-icon>
                              <ion-icon name="hourglass-outline" class="indicator temp" *ngIf="!imgData.file_id"></ion-icon>
                            </div>
                            <ion-img [src]="imgData.url" *ngIf="isImage(imgData.mime_type) === true"></ion-img>
                            <ion-img src="assets/img/pdf-icon.png" *ngIf="imgData.mime_type === 'application/pdf'" style="width: 60%;margin: auto 0;"></ion-img>
                            <div class="loader-upload" *ngIf="imgData.uploading === true">
                              <ion-spinner name="bubbles" *ngIf="imgData.uploading === true"></ion-spinner>
                              <!--<ion-icon name="checkmark-sharp" *ngIf="imgData.success === true" style="color: #44bd00;font-size: 3rem;background: #f9f9f9;border-radius: 50%;padding: 8px;"></ion-icon>-->
                            </div>
<!--                            <ion-icon class="wrong-upload" name="close-sharp" *ngIf="imgData.success === false"></ion-icon>-->
                            <div class="file-name">
                              <label for="">Etiqueta</label>
                              <input type="text" autocomplete="off" value="{{imgData.etiqueta}}" [(ngModel)]="imgData.etiqueta" [disabled]="(imgData.file_id && imgData.file_id > 0 ? true : false)">
                              <small class="error" *ngIf="imgData.fileErrors">{{imgData.fileErrors}}</small>
                            </div>
                          </div>
                        </ion-col>
                      </ion-row>

                      <!-- <ion-img [src]="bodyImgURL"></ion-img> -->
                    </div>

                  </ng-container>
                </fieldset>
              </ion-card-content>
              <ion-card-title>
                <div class="card-action-buttons">
                  <ion-button color="success" (click)="saveProcess('datos_cliente')">GUARDAR</ion-button>
                </div>
              </ion-card-title>
            </ion-card>


            <mat-action-row>
              <button (click)="prevStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-back-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button> &nbsp; &nbsp;

              <button (click)="nextStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-forward-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </div>
      </mat-accordion> <!-- Datos Cliente -->
      <mat-accordion>
        <div class="accordion-margin">
          <mat-expansion-panel (opened)="setStep(4)" [expanded]="step === 4" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Cobranza (En desarrollo)
              </mat-panel-title>
              <mat-panel-description style="margin: 0; justify-content: flex-end;">
                <ion-icon name="wallet"></ion-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <ion-card>
              <ion-card-content>
                <h4 style="font-weight: 500">DESCRIPCION DE LOS CARGOS Y PRE-AUTORIZACIONES</h4>
                <ion-row>
                  <ion-col size="6" class="ion-no-padding">
                    <h4 style="margin: 0; padding: 0;">Balance por saldar: {{(generalDataForm && generalDataForm.controls.total.value) ? (generalDataForm.controls.total.value | currency) : '--'}}</h4>
                  </ion-col>
                </ion-row>
                <br>
                <mat-divider></mat-divider>
                <br>
                <div>
                  <ion-row>
                    <ion-col size="12" size-md="6" class="ion-align-self-center">
                      <h4 style="margin: 0;" class="ion-text-center ion-text-md-left">PRE-AUTORIZACIONES</h4>
                    </ion-col>
                    <ion-col size="12" size-md="6" class="ion-text-end">
                      <button mat-raised-button class="button-secondary" (click)="agregarTarjetaForm(1)">
                        <span style="font-size: 1.3rem;margin-right: 0.5rem;">+</span> <ion-icon name="card"></ion-icon> &nbsp;Tarjeta
                      </button>
                    </ion-col>
                  </ion-row>

                  <ng-container *ngFor="let cobranzaAuth of cobranzaProgData">
                    <ion-row class="border-ion-row" *ngIf="cobranzaAuth.tipo == 1">
                      <ion-col size="12" size-md="8">
                        <table class="cards-table">
                          <tbody>
                          <tr>
                            <td style="min-width: 60px; max-width: 60px">
                              <div class="action-buttons">
                                <button *ngIf="!cobranzaAuth.id || cobranzaAuth.edit === true" (click)="updateSaveCobro(cobranzaAuth)" class="mat-elevation-z0 button-success" mat-mini-fab>
                                  <mat-icon>save</mat-icon>
                                </button>
                                <button *ngIf="cobranzaAuth.id && cobranzaAuth.edit !== true" class="mat-elevation-z0" mat-mini-fab color="warn">
                                  <mat-icon>remove</mat-icon>
                                </button>
                                <button *ngIf="cobranzaAuth.edit !== true && cobranzaAuth.id" (click)="enableDisableEditCobro(cobranzaAuth, true)" style="margin-top: 10px" class="mat-elevation-z0" mat-mini-fab color="accent">
                                  <mat-icon>edit</mat-icon>
                                </button>
                                <button *ngIf="cobranzaAuth.edit === true && cobranzaAuth.id" (click)="enableDisableEditCobro(cobranzaAuth, false)" style="margin-top: 10px" class="mat-elevation-z0 button-cancel" mat-mini-fab>
                                  <mat-icon>cancel</mat-icon>
                                </button>
                              </div>

                            </td>
                            <td>
                              {{(cobranzaAuth.tarjeta && cobranzaAuth.tarjeta.c_type) ? cobranzaAuth.tarjeta.c_type : '--'}}
                              <br>
                              <button *ngIf="cobranzaAuth.edit === true && cobranzaAuth.id" (click)="updateTarjeta(cobranzaAuth, 1)" style="margin-top: 10px" class="mat-elevation-z0 button-secondary" mat-icon-button>
                                <mat-icon>price_change</mat-icon>
                              </button>
                            </td>
                            <td>{{(cobranzaAuth.tarjeta && cobranzaAuth.tarjeta.c_method) ? cobranzaAuth.tarjeta.c_method : '--'}}</td>
                            <td>{{(cobranzaAuth.tarjeta && (cobranzaAuth.tarjeta.c_cn1 && cobranzaAuth.tarjeta.c_cn4)) ? cobranzaAuth.tarjeta.c_cn1 + '*' + cobranzaAuth.tarjeta.c_cn4: '--'}}</td>
                            <td>{{(cobranzaAuth.tarjeta && (cobranzaAuth.tarjeta.c_month && cobranzaAuth.tarjeta.c_year)) ? cobranzaAuth.tarjeta.c_month + '/' + cobranzaAuth.tarjeta.c_year: '--'}}</td>
                            <td>
                              <div class="table-input">
                                PRE-AUTH: <input type="text" [(ngModel)]="cobranzaAuth.cod_banco" [readOnly]="cobranzaAuth.edit !== true">
                                <p class="input-hint" *ngIf="cobranzaAuth.edit !== true">Solo Lectura</p>
                              </div>
                            </td>
                            <td>
                              <div class="table-input">
                                MONTO ({{cobranzaAuth.moneda}}): <input type="number" [(ngModel)]="cobranzaAuth.monto" [readOnly]="cobranzaAuth.edit !== true">
                                <p class="input-hint" *ngIf="cobranzaAuth.edit !== true">Solo Lectura</p>
                              </div>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </ion-col>
                      <ion-col size="12" size-md="4" class="ion-no-padding">
                        <fieldset>
                          <legend>Img. Voucher</legend>
                          <div style="text-align: center;">
                            <app-camera [justButton]="true"></app-camera>
                          </div>
                        </fieldset>
                      </ion-col>
                    </ion-row>
                  </ng-container>

                </div> <!-- PRE AUTORIZACIONES -->

                <mat-divider></mat-divider>
                <br>
                <div>
                  <ion-row>
                    <ion-col size="12" size-md="6" class="ion-align-self-center">
                      <h4 style="margin: 0;" class="ion-text-center ion-text-md-left">CARGOS</h4>
                    </ion-col>
                    <ion-col size="12" size-md="6" class="ion-text-end">
                      <button mat-raised-button class="button-secondary" (click)="agregarTarjetaForm(2)">
                        <span style="font-size: 1.3rem;margin-right: 0.5rem;">+</span> <ion-icon name="card"></ion-icon> &nbsp;Tarjeta
                      </button>
                    </ion-col>
                  </ion-row>

                  <ng-container *ngFor="let cobranzaPago of cobranzaProgData">
                    <ion-row class="border-ion-row" *ngIf="cobranzaPago.tipo === 2">
                      <ion-col size="12" size-md="8">
                        <table class="cards-table">
                          <tbody>
                          <tr>
                            <td>{{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_type) ? cobranzaPago.tarjeta.c_type : '--'}}</td>
                            <td>{{(cobranzaPago.tarjeta && cobranzaPago.tarjeta.c_method) ? cobranzaPago.tarjeta.c_method : '--'}}</td>
                            <td>{{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_cn1 && cobranzaPago.tarjeta.c_cn4)) ? cobranzaPago.tarjeta.c_cn1 + '*' + cobranzaPago.tarjeta.c_cn4: '--'}}</td>
                            <td>{{(cobranzaPago.tarjeta && (cobranzaPago.tarjeta.c_month && cobranzaPago.tarjeta.c_year)) ? cobranzaPago.tarjeta.c_month + '/' + cobranzaPago.tarjeta.c_year: '--'}}</td>
                            <td>
                              <div class="table-input">
                                PAGO: <input type="text" [(ngModel)]="cobranzaPago.cod_banco">
                              </div>
                            </td>
                            <td>
                              <div class="table-input">
                                MONTO: <input type="number" [(ngModel)]="cobranzaPago.monto"> {{cobranzaPago.moneda}}
                              </div>
                            </td>
                          </tr>
                          </tbody>
                        </table>
                      </ion-col>
                      <ion-col size="12" size-md="4" class="ion-no-padding">
                        <fieldset>
                          <legend>Img. Voucher</legend>
                          <div style="text-align: center;">
                            <app-camera [justButton]="true"></app-camera>
                          </div>
                        </fieldset>
                      </ion-col>
                    </ion-row>
                  </ng-container>

                </div> <!-- CARGOS -->

              </ion-card-content>
            </ion-card>

            <mat-action-row>
              <button (click)="prevStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-back-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button> &nbsp; &nbsp;

              <button (click)="nextStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-forward-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </div>
      </mat-accordion> <!-- COBRANZA Detalle cargos y pre-autorizaciones -->
      <mat-accordion>
        <div class="accordion-margin">
          <mat-expansion-panel (opened)="setStep(5)" [expanded]="step === 5" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Check List - Salida (Por desarrollar)
              </mat-panel-title>
              <mat-panel-description style="margin: 0; justify-content: flex-end;">
                <ion-icon name="checkmark-circle"></ion-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <ion-card>
              <ion-card-content >
                <h4 class="ion-text-center">Por diseñar vista ....</h4>

                <ion-row  (loadeddata)="initReviewCanva()">
                  <ion-col size="12" id="revisionRowW">
                    <canvas id="revisionC"></canvas>
                  </ion-col>
                </ion-row>
              </ion-card-content>
            </ion-card>
            <mat-action-row>
              <button (click)="prevStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-back-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button> &nbsp; &nbsp;

              <button (click)="nextStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-forward-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </div>
      </mat-accordion> <!--   Check List - Salida -->
      <mat-accordion>
        <div class="accordion-margin">
          <mat-expansion-panel (opened)="setStep(6)" [expanded]="step === 6" hideToggle>
            <mat-expansion-panel-header>
              <mat-panel-title>
                Firma (Por desarrollar)
              </mat-panel-title>
              <mat-panel-description style="margin: 0; justify-content: flex-end;">
                <ion-icon name="pencil"></ion-icon>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <ion-card>
              <ion-card-content>
                <ion-row>
                  <ion-col size="12">
                    <p>Acepto que texto de aceptación --> Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam autem deserunt dignissimos dolore doloremque ducimus error, eveniet, id magnam minus, odio optio qui quisquam quod repudiandae sequi sint suscipit ullam.</p>
                  </ion-col>
                </ion-row>
                <hr style="background: var(--ion-color-secondary)">

                <app-signature-capture (signatureEmit)="captureSignature($event)"
                                       [instanceType]="'plain'"></app-signature-capture>
              </ion-card-content>
            </ion-card>

            <mat-action-row>
              <button (click)="prevStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-back-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button> &nbsp; &nbsp;

              <button (click)="nextStep()" mat-flat-button style="font-size: 1.5rem;">
                <ion-icon name="chevron-forward-outline" style="color: var(--ion-color-medium);"></ion-icon>
              </button>
            </mat-action-row>
          </mat-expansion-panel>
        </div>
      </mat-accordion> <!-- Captura Firma -->
    </ion-col>
  </ion-row>


</ion-content>
