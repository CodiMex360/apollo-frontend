<div class="main-content">
  <ion-row>
    <ion-col size="12">
      <ion-card class="ion-no-margin ion-no-padding">
        <ion-card-header>
          <h2>Comisión Rentador</h2>
        </ion-card-header>
        <ion-card-content>

          <ion-row class="ion-justify-content-end">
            <ion-col size="12" size-md="8" class="ion-align-self-end">
              <ion-row class="ion-align-items-baseline">
                <ion-col size sizeMd="5">
                  <mat-form-field appearance="legacy">
                    <mat-label>Ingresa un rango de fechas</mat-label>
                    <mat-date-range-input [formGroup]="range" [rangePicker]="picker" [max]="maxDate">
                      <input matStartDate formControlName="start" placeholder="Desde:" (click)="picker.open()">
                      <input matEndDate formControlName="end" placeholder="Hasta:"  (click)="picker.open()">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>

                    <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')">Fecha Inválida
                    </mat-error>
                    <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')">Fecha Inválida</mat-error>
                  </mat-form-field>
                </ion-col>
                <ion-col size sizeMd="5">
                  <mat-form-field appearance="legacy">
                    <mat-label>Comisionista</mat-label>
                    <mat-select [formControl]="selectedUserGroup"  (selectionChange)="catchChange($event)">
                      <mat-option>-- Selecciona --</mat-option>
                      <mat-optgroup *ngFor="let group of usuariosGroup" [label]="group.group | titlecase"
                                    [disabled]="group.disabled">
                        <mat-option *ngFor="let user of group.user" [value]="user">
                          {{user.nombre}} {{user.apellidos ?? ''}}
                        </mat-option>
                      </mat-optgroup>
                    </mat-select>
                  </mat-form-field>
                </ion-col>
                <ion-col size sizeMd="2">
                  <div class="action-btn-container">
                    <button mat-raised-button class="button-secondary" (click)="searchFilter()">
                      <mat-icon>find_in_page</mat-icon>
                    </button>
                    <button mat-raised-button color="accent" *ngIf="searchPayload.usuario_data || searchPayload.rango_fechas" (click)="clearSearchFilter()">
                      <mat-icon>cleaning_services</mat-icon>
                    </button>
                  </div>
                </ion-col>
              </ion-row>
              <ion-searchbar placeholder="Ingrese un valor para filtrar los resultados de la tabla..." class="ion-no-padding" (ionInput)="applyFilter($event)" (ionCancel)="onSearchClear()"></ion-searchbar>
            </ion-col>
            <ion-col size="4">
              <table class="complement-table reports">
                <tbody>
                <tr>
                  <td>Total:</td>
                  <td> <span style="color: var(--ion-color-success); font-weight: 600">{{totalCobrado | currency}} MXN</span></td>
                </tr>
                <tr>
                  <td>% Comisión:</td>
                  <td class="table-input">
                    <input type="number" [(ngModel)]="porcentaje" (ngModelChange)="calcComision()">
                  </td>
                </tr>
                <tr>
                  <td>Comisión:</td>
                  <td>{{comisionCalc | currency}}</td>
                </tr>
                </tbody>
              </table>
            </ion-col>
          </ion-row>
          <div class="mat-elevation-z8 table-container">
            <mat-table [dataSource]="listRentasPorComisionistas" matSort>

              <!-- fecha_creacion -->
              <ng-container matColumnDef="fecha_creacion">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Creación</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.created_at | date: 'short'}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- fecha_cierre -->
              <ng-container matColumnDef="fecha_cierre">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Cierre</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.fecha_retorno | date: 'short'}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- sucursal -->
              <ng-container matColumnDef="sucursal">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Sucursal</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.salida?.alias}}
                    </p>
                    <p>
                      Total salida: {{row.total_salida | currency}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- folio -->
              <ng-container matColumnDef="folio">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Folio</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.num_contrato}}
                    </p>
                    <p>
                      Total retorno: {{row.total_retorno | currency}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- placas-->
              <ng-container matColumnDef="placas">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Placas</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.vehiculo?.placas}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- rentador-->
              <ng-container matColumnDef="rentador">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Rentador</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.usuario?.nombre}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- cliente-->
              <ng-container matColumnDef="cliente">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.cliente?.nombre}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- dias_renta-->
              <ng-container matColumnDef="dias_renta">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Días renta</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.total_dias}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- total_cobrado-->
              <ng-container matColumnDef="total_cobrado">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Total</mat-header-cell>
                <mat-cell *matCellDef="let row">
                  <div class="column">
                    <p>
                      {{row.total_cobrado ? (row.total_cobrado | currency) : '--'}}
                    </p>
                  </div>
                </mat-cell>
              </ng-container>

              <!-- rows staticos-->
              <ng-container matColumnDef="init">
                <mat-footer-cell *matFooterCellDef colspan="7" style="color: var(--ion-color-primary); font-weight: 400;">
                  Ingrese un valor usando el motor de búsqueda ubicado en la parte superior
                </mat-footer-cell>
              </ng-container>

              <ng-container matColumnDef="loading">
                <mat-footer-cell *matFooterCellDef colspan="7">
                  <mat-spinner [diameter]="40"></mat-spinner>
                </mat-footer-cell>
              </ng-container>

              <ng-container matColumnDef="noData">
                <mat-footer-cell *matFooterCellDef colspan="8" style="color: #2196F3">
                  No data was found
                </mat-footer-cell>
              </ng-container>

              <!--Table Footer-->
              <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
              <!--                <ng-container *ngIf="isModal">-->
              <!--                  <mat-row *matRowDef="let row; columns: displayedColumns;" (click)="editAction(row)" [ngClass]="{hovered: row.hovered, highlighted: row.id === editEmpresa.id}" (mouseover)="row.hovered = true" (mouseout)="row.hovered = false"></mat-row>-->
              <!--                </ng-container>-->
              <ng-container>
                <mat-row *matRowDef="let row; columns: displayedColumns;"  (mouseover)="row.hovered = true" (mouseout)="row.hovered = false"></mat-row>
              </ng-container>

              <mat-footer-row *matFooterRowDef="['loading']" [ngClass]="{hide: spinner === false}"></mat-footer-row>
              <mat-footer-row *matFooterRowDef="['init']" [ngClass]="{'hide':listRentasPorComisionistas!=null || spinner === true}"></mat-footer-row>
              <mat-footer-row *matFooterRowDef="['noData']"
                              [ngClass]="{hide:!(listRentasPorComisionistas!=null && listRentasPorComisionistas.data.length==0)}">
              </mat-footer-row>
            </mat-table>

            <!-- paginator -->
            <mat-paginator [pageSizeOptions]="[5, 10, 30, 50, 100]" [pageSize]="15"
                           showFirstLastButtons></mat-paginator>
          </div> <!-- table content-->
        </ion-card-content>
      </ion-card>
    </ion-col>
  </ion-row>

</div>
